<?xml version="1.0" encoding="UTF-8" standalone="no"?><xccdf:Benchmark xmlns:xccdf="http://checklists.nist.gov/xccdf/1.1" xmlns:cdfp="http://www.cisecurity.org/xccdf/platform/0.2.3" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dsig="http://www.w3.org/2000/09/xmldsig#" xmlns:ecl="http://cisecurity.org/check" xmlns:oval-def="http://oval.mitre.org/XMLSchema/oval-definitions-5" xmlns:oval4="http://oval.mitre.org/XMLSchema/oval" xmlns:xccdf10="http://checklists.nist.gov/xccdf/1.0" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="cis_vmware_esx_4_benchmark" xsi:schemaLocation="http://checklists.nist.gov/xccdf/1.1 ../misc/xsd/xccdf-1.1.4.xsd http://cisecurity.org/check ../misc/xsd/ecl.xsd">
    <xccdf:status date="2011-02-15">accepted</xccdf:status>
    <xccdf:title>CIS VMware ESX 4 Benchmark</xccdf:title>
    <xccdf:description>
This document, Security Configuration Benchmark for VMware vSphere (ESX 4), provides prescriptive guidance for establishing a secure configuration posture for VMware vSphere (ESX 4) running on hardware compliant with the vendor compatibility guide http://www.vmware.com/resources/compatibility/search.php?action=base&amp;deviceCategory=server. 

This guide was tested against VMware vSphere (ESX 4.1.0) as installed using a vendor evaluation ISO, build number 260247 downloaded from http://www.vmware.com. To obtain the latest version of this guide, please visit http://cisecurity.org.
    </xccdf:description>
    <xccdf:notice id="terms-of-use" xml:lang="en">
        BACKGROUND.
        
        The Center for Internet Security ("CIS") provides benchmarks, scoring tools, software, data, information, suggestions, ideas, and other services and materials from the CIS website or elsewhere ("Products") as a public service to Internet users worldwide.  Recommendations contained in the Products ("Recommendations") result from a consensus-building process that involves many security experts and are generally generic in nature.  The Recommendations are intended to provide helpful information to organizations attempting to evaluate or improve the security of their networks, systems, and devices.  Proper use of the Recommendations requires careful analysis and adaptation to specific user requirements.  The Recommendations are not in any way intended to be a "quick fix" for anyone's information security needs.
        
        NO REPRESENTATIONS, WARRANTIES, OR COVENANTS.
        
        CIS makes no representations, warranties, or covenants whatsoever as to (i) the positive or negative effect of the Products or the Recommendations on the operation or the security of any particular network, computer system, network device, software, hardware, or any component of any of the foregoing or (ii) the accuracy, reliability, timeliness, or completeness of  the Products or the Recommendations.  CIS is providing the Products and the Recommendations "as is" and "as available" without representations, warranties, or covenants of any kind.  
        
        USER AGREEMENTS.
        
        By using the Products and/or the Recommendations, I and/or my organization ("We") agree and acknowledge that:
        
        1.	No network, system, device, hardware, software, or component can be made fully secure;
        2.	We are using the Products and the Recommendations solely at our own risk;
        3.	We are not compensating CIS to assume any liabilities associated with our use of the Products or the Recommendations, even risks that result from 		CIS's negligence or failure to perform; 
        4.	We have the sole responsibility to evaluate the risks and benefits of the Products and Recommendations to us and to adapt the Products and the 			Recommendations to our particular circumstances and requirements;
        5.	Neither CIS, nor any CIS Party (defined below) has any responsibility to make any corrections, updates, upgrades, or bug fixes; or to notify us of 		the need for any such corrections, updates, upgrades, or bug fixes; and
        6.	Neither CIS nor any CIS Party has or will have any liability to us whatsoever (whether based in contract, tort, strict liability or otherwise) for 		any direct, indirect, incidental, consequential, or special damages (including without limitation loss of profits, loss of sales, loss of or damage 		to reputation,loss of customers, loss of software, data, information or emails, loss of privacy, loss of use of any computer or other equipment, 	business interruption, wasted management or other staff resources or claims of any kind against us from third parties) arising out of or in any way 	Connected with our use of or our inability to use any of the Products or Recommendations (even if CIS has been advised of the possibility of such 	damages), including without limitation any liability associated with infringement of intellectual property, defects, bugs, errors, omissions, 	viruses, worms, backdoors, Trojan horses or other harmful items.
        
        GRANT OF LIMITED RIGHTS.
        
        CIS hereby grants each user the following rights, but only so long as the user complies with all of the terms of these Agreed Terms of Use:
        
        1.	Except to the extent that we may have received additional authorization pursuant to a written agreement with CIS, each user may download, install and 	use each of the Products on a single computer;
        2.	Each user may print one or more copies of any Product or any component of a Product that is in a .txt, .pdf, .doc, .mcw, or .rtf format, provided 		that all such copies are printed in full and are kept intact, including without limitation the text of this Agreed Terms of Use in its entirety.
        
        RETENTION OF INTELLECTUAL PROPERTY RIGHTS; LIMITATIONS ON DISTRIBUTION.
        
        The Products are protected by copyright and other intellectual property laws and by international treaties.  We acknowledge and agree that we are not acquiring title to any intellectual property rights in the Products and that full title and all ownership rights to the Products will remain the exclusive property of CIS or CIS Parties.  CIS reserves all rights not expressly granted to users in the preceding section entitled "Grant of limited rights."
        Subject to the paragraph entitled "Special Rules" (which includes a waiver, granted to some classes of CIS Members, of certain limitations in this paragraph), and except as we may have otherwise agreed in a written agreement with CIS, we agree that we will not (i) decompile, disassemble, reverse engineer, or otherwise attempt to derive the source code for any software Product that is not already in the form of source code; (ii) distribute, redistribute, encumber, sell, rent, lease, lend, sublicense, or otherwise transfer or exploit rights to any Product or any component of a Product; (iii) post any Product or any component of a Product on any website, bulletin board, ftp server, newsgroup, or other similar mechanism or device, without regard to whether such mechanism or device is internal or external, (iv) remove or alter trademark, logo, copyright or other proprietary notices, legends, symbols or labels in any Product or any component of a Product; (v) remove these Agreed Terms of Use from, or alter these Agreed Terms of Use as they appear in, any Product or any component of a Product; (vi) use any Product or any component of a Product with any derivative works based directly on a Product or any component of a Product; (vii) use any Product or any component of a Product with other products or applications that are directly and specifically dependent on such Product or any component for any part of their functionality, or (viii) represent or claim a particular level of compliance with a CIS Benchmark, scoring tool or other Product.  We will not facilitate or otherwise aid other individuals or entities in any of the activities listed in this paragraph.
        We hereby agree to indemnify, defend, and hold CIS and all of its officers, directors, members, contributors, employees, authors, developers, agents, affiliates, licensors, information and service providers, software suppliers, hardware suppliers, and all other persons who aided CIS in the creation, development, or maintenance of the Products or Recommendations ("CIS Parties") harmless from and against any and all liability, losses, costs, and expenses (including attorneys' fees and court costs) incurred by CIS or any CIS Party in connection with any claim arising out of any violation by us of the preceding paragraph, including without limitation CIS's right, at our expense, to assume the exclusive defense and control of any matter subject to this indemnification, and in such case, we agree to cooperate with CIS in its defense of such claim.  We further agree that all CIS Parties are third-party beneficiaries of our undertakings in these Agreed Terms of Use. 
        
        SPECIAL RULES.
        
        CIS has created and will from time to time create, special rules for its members and for other persons and organizations with which CIS has a written contractual relationship.  Those special rules will override and supersede these Agreed Terms of Use with respect to the users who are covered by the special rules.
        CIS hereby grants each CIS Security Consulting or Software Vendor Member and each CIS Organizational User Member, but only so long as such Member remains in good standing with CIS and complies with all of the terms of these Agreed Terms of Use, the right to distribute the Products and Recommendations within such Member's own organization, whether by manual or electronic means.  Each such Member acknowledges and agrees that the foregoing grant is subject to the terms of such Member's membership arrangement with CIS and may, therefore, be modified or terminated by CIS at any time.
        CHOICE OF LAW; JURISDICTION; VENUE.
        
        We acknowledge and agree that these Agreed Terms of Use will be governed by and construed in accordance with the laws of the State of Maryland, that any action at law or in equity arising out of or relating to these Agreed Terms of Use shall be filed only in the courts located in the State of Maryland, that we hereby consent and submit to the personal jurisdiction of such courts for the purposes of litigating any such action.  If any of these Agreed Terms of Use shall be determined to be unlawful, void, or for any reason unenforceable, then such terms shall be deemed severable and shall not affect the validity and enforceability of any remaining provisions.
        
        BY USING THE PRODUCTS I(WE) ACKNOWLEDGE THAT WE HAVE READ THESE AGREED TERMS OF USE IN THEIR ENTIRETY, UNDERSTAND THEM, AND I(WE) AGREE TO BE BOUND BY THEM IN ALL RESPECTS.      
    </xccdf:notice>
    <xccdf:version>4.1.0.30</xccdf:version>
    <xccdf:Profile id="ESX_4_1-level-1-profile">
        <xccdf:title>Level 1</xccdf:title>
        <xccdf:description>
            <xhtml:p>This profile contains all Level 1 configuration items</xhtml:p>
        </xccdf:description>
        <xccdf:select idref="ESX-1.7.1-Validate-System-Before-Making-Changes" selected="true"/>
        <xccdf:select idref="ESX-1.7.2-Configure-Firmware-BIOS" selected="true"/>
        <xccdf:select idref="ESX-1.7.3-Change-the-Default-Credentials-for-Remote-Host-Access" selected="true"/>
        <xccdf:select idref="Segregate-Networks" selected="true"/>
        <xccdf:select idref="Partition-Disks-to-Avoid-Consumption" selected="true"/>
        <xccdf:select idref="Minimize-Boot-Services" selected="true"/>
        <xccdf:select idref="Configure-NTP" selected="true"/>
        <xccdf:select idref="Create-Warning-Banners" selected="true"/>
        <xccdf:select idref="Maintain-Vendor-Patches" selected="true"/>
        <xccdf:select idref="Utilize-Host-Profiles" selected="true"/>
        <xccdf:select idref="Do-Not-Use-Red-Hat-Based-Vulnerability-Scanners" selected="true"/>
        <xccdf:select idref="Do-Not-Use-Linux-Based-Configuration-Commands" selected="true"/>
        <xccdf:select idref="Monitor-File-Integrity" selected="true"/>
        <xccdf:select idref="Configure-SSH-Access" selected="true"/>
        <xccdf:select idref="Implement-SUDO" selected="true"/>
        <xccdf:select idref="Set-File-Permissions" selected="true"/>
        <xccdf:select idref="Strengthen-Password-Controls-History" selected="true"/>
        <xccdf:select idref="Strengthen-Password-Controls-Composition-Strength" selected="true"/>
        <xccdf:select idref="Strengthen-Password-Controls-Maximum-Days" selected="true"/>
        <xccdf:select idref="Strengthen-Password-Controls-Minimum-Days" selected="true"/>
        <xccdf:select idref="Strengthen-Password-Controls-Length" selected="true"/>
        <xccdf:select idref="Ensure-Host-Direct-Web-Access-is-Disabled" selected="true"/>
        <xccdf:select idref="ESX-User-Accounts-Not-Synchronized" selected="true"/>
        <xccdf:select idref="Use-vCenter-and-vSphere-Client-for-Administration" selected="true"/>
        <xccdf:select idref="Use-Directory-Service-Authentication" selected="true"/>
        <xccdf:select idref="Use-vCenter-Automatic-Password-Change-for-vpxuser" selected="true"/>
        <xccdf:select idref="Require-Authentication-for-Single-User-Mode" selected="true"/>
        <xccdf:select idref="Disable-Console-Root-Login" selected="true"/>
        <xccdf:select idref="Establish-Log-Sizes-and-Compression" selected="true"/>
        <xccdf:select idref="Review-Logs" selected="true"/>
        <xccdf:select idref="Configure-syslogd" selected="true"/>
        <xccdf:select idref="Protect-Against-MAC-Address-Spoofing" selected="true"/>
        <xccdf:select idref="Protect-Against-Forged-Transmits" selected="true"/>
        <xccdf:select idref="Protect-Against-Promiscuous-Mode" selected="true"/>
        <xccdf:select idref="Configure-Firewall-to-Allow-Only-Authorized-Traffic" selected="true"/>
        <xccdf:select idref="Ensure-All-Host-Browser-Sessions-are-https" selected="true"/>
        <xccdf:select idref="Ensure-All-Host-Port-Groups-are-In-Use" selected="true"/>
        <xccdf:select idref="Avoid-Conflicting-VLAN-Numbering" selected="true"/>
        <xccdf:select idref="Match-vSwitch-VLAN-Numbering-to-Physical-Switch-Trunk-Ports" selected="true"/>
        <xccdf:select idref="Use-Bi--directional-Chap-Authentication-for-ISCSI-Devices" selected="true"/>
        <xccdf:select idref="Do-Not-Include-a-Service-Console-Portgroup-on-an-iSCSI-vSwitch" selected="true"/>
        <xccdf:select idref="Use-a-Unique-CHAP-Secret-for-Each-Host" selected="true"/>
        <xccdf:select idref="Disable-the-Managed-Object-Browser" selected="true"/>
        <xccdf:select idref="Disable-Guest-Control-of-Hardware-Devices" selected="true"/>
        <xccdf:select idref="Appropriately-Size-the-Information-a-Guest-Can-Store-in-a-Configuration-File" selected="true"/>
        <xccdf:select idref="Disable-Guest-Copy-and-Paste" selected="true"/>
        <xccdf:select idref="Rotate-VM-Log-Files-on-the-Host-and-Limit-Their-Size" selected="true"/>
        <xccdf:select idref="Retain-Virtual-Machine-Communications-Interface-VMCI-in-a-Disabled-State" selected="true"/>
        <xccdf:select idref="Prevent-Virtual-Disk-Shrinkage" selected="true"/>
        <xccdf:select idref="Set-RemoteDisplay.maxConnections-to-One-Level" selected="true"/>
        <xccdf:select idref="Disconnect-Unneeded-Devices" selected="true"/>
        <xccdf:select idref="Remotely-Log-VMs-with-Non--Persistent-Disks" selected="true"/>
        <xccdf:select idref="Disable-the-VIX-API" selected="true"/>
        <xccdf:select idref="Disable-ESX-Host-Performance-Data-Delivery-to-a-VM" selected="true"/>
        <xccdf:select idref="Disable-VMsafe-Except-for-Approved-Appliances" selected="true"/>
        <xccdf:select idref="Disable-VM-Participation-in-VMsafe-Introspection-Unless-Approved" selected="true"/>
        <xccdf:select idref="Disable-VM-DirectPath-IO-Devices-Unless-Approved" selected="true"/>
        <xccdf:select idref="Ensure-Linked-Clones-are-of-Equal-Security-Classification" selected="true"/>
        <xccdf:select idref="Use-Active-Directory-Authentication-with-vMA-4--1" selected="true"/>
        <xccdf:select idref="Monitor-Thin-Provisioned-Use-to-Avoid-Storage-Over--committment" selected="true"/>
        <xccdf:select idref="Password-Protect-the-Boot-Loader-GRUB" selected="true"/>
        <xccdf:select idref="Replace-Vendor-SSL-Certificates" selected="true"/>
        <xccdf:select idref="Configure-Security-Event-Logging--auditd" selected="true"/>
    </xccdf:Profile>
    <xccdf:Value id="NTP.primary" interactive="true" interfaceHint="text" type="string">
        <xccdf:title>Primary NTP IP Address</xccdf:title>
        <xccdf:question>What is the IPV4 address of your primary NTP server?</xccdf:question>
        <xccdf:value/>
        <xccdf:default>0.0.0.0</xccdf:default>
    </xccdf:Value>
    <xccdf:Value id="NTP.secondary" interactive="true" interfaceHint="text" type="string">
        <xccdf:title>Secondary NTP IP Address</xccdf:title>
        <xccdf:question>What is the IPV4 address of your secondary NTP server?</xccdf:question>
        <xccdf:value/>
        <xccdf:default>0.0.0.0</xccdf:default>
    </xccdf:Value>
    <xccdf:Value id="NTP.tertiary" interactive="true" interfaceHint="text" type="string">
        <xccdf:title>Tertiary NTP IP Address</xccdf:title>
        <xccdf:question>What is the IPV4 address of your third NTP server?</xccdf:question>
        <xccdf:value/>
        <xccdf:default>0.0.0.0</xccdf:default>
    </xccdf:Value>
    <xccdf:Value id="remote.logserver" interactive="true" interfaceHint="text" type="string">
        <xccdf:title>Name of the Remote Host that Consolidates Log Files</xccdf:title>
        <xccdf:question>What is the name of the destination host where log files are collected?</xccdf:question>
        <xccdf:value/>
        <xccdf:default>loghost.company.com</xccdf:default>
    </xccdf:Value>

    <xccdf:Group id="consensus-guidance">
        <xccdf:title>Consensus Guidance</xccdf:title>
        <xccdf:description>
            <xhtml:p>This guide was created using a consensus review process comprised of volunteer and contract 
                subject matter experts. Consensus participants provide perspective from a diverse set of 
                backgrounds including consulting, software development, audit and compliance, security 
                research, operations, government, and legal.</xhtml:p>
            
            <xhtml:p>Each CIS benchmark undergoes two phases of consensus review. The first phase occurs during 
                initial benchmark development. During this phase, subject matter experts convene to discuss, 
                create, and test working drafts of the benchmark. This discussion occurs until consensus has been 
                reached on benchmark recommendations. The second phase begins after the benchmark has been 
                released to the public Internet. During this phase, all feedback provided by the Internet 
                community is reviewed by the consensus team for incorporation in the CIS benchmark. If you are 
                interested in participating in the consensus review process, please send us a note to 
                feedback@cisecurity.org. </xhtml:p>
        </xccdf:description>
    </xccdf:Group>
    <xccdf:Group id="intended-audience">
        <xccdf:title>Intended Audience</xccdf:title>
        <xccdf:description>
            <xhtml:p>This document is intended for system and application administrators, security specialists, 
                auditors, help desk, and platform deployment personnel, who plan to develop, deploy, assess, or 
                secure solutions that incorporate VMware vSphere (ESX 4 ) on hardware compliant with the 
                vendor compatibility guide.</xhtml:p>
        </xccdf:description>
    </xccdf:Group>
    <xccdf:Group id="acknowledgements">
        <xccdf:title>Acknowledgements</xccdf:title>
        <xccdf:description>
            <xhtml:p>This benchmark exemplifies the great things a community of users, vendors, and subject matter 
                experts can accomplish through consensus collaboration. The CIS community thanks the entire 
                consensus team with special recognition to the following individuals who contributed greatly to 
                the creation of this guide: </xhtml:p>
            <xhtml:p><xhtml:strong>Authors</xhtml:strong><xhtml:br/>
                Michael Hoesing, University of Nebraska at Omaha
            </xhtml:p>
            
            <xhtml:p>
                <xhtml:strong>Maintainers</xhtml:strong><xhtml:br/>
                Edward L. Haletky, AstroArch Consulting, Inc.<xhtml:br/> 
                Michael Hoesing, University of Nebraska at Omaha<xhtml:br/> 
                Iben Rodriguez <xhtml:br/>
                Lance Seelbach, CSC 
            </xhtml:p>
            
            <xhtml:p>
                <xhtml:strong>Contributors and Reviewers</xhtml:strong><xhtml:br/>
                Blake Frantz, Center for Internet Security <xhtml:br/>
                Edward L. Haletky, AstroArch Consulting, Inc. <xhtml:br/>
                Joel Kirch <xhtml:br/>
                Steven Piliero, Center for Internet Security<xhtml:br/> 
                John Reeman, VM Informer <xhtml:br/>
                Iben Rodriguez <xhtml:br/>
                Lance Seelbach, CSC <xhtml:br/>
            </xhtml:p>
            <xhtml:p>The CIS community also extends special thanks to the contributors of the CIS VMware ESX 3.5 
                Benchmark, on which this benchmark builds upon. </xhtml:p>
        </xccdf:description>
    </xccdf:Group>
    <xccdf:Group id="typographic-conventions">
        <xccdf:title>Typographic Conventions</xccdf:title>
        <xccdf:description>
            <xhtml:p/>
        </xccdf:description>
    </xccdf:Group>
    <xccdf:Group id="configuration-levels">
        <xccdf:title>Configuration Levels</xccdf:title>
        <xccdf:description>
            <xhtml:p>This section defines the configuration levels that are associated with each benchmark 
                recommendation. Configuration levels represent increasing levels of security assurance.</xhtml:p>
              
            <xhtml:p>
                <xhtml:strong>Level-I Benchmark settings/actions</xhtml:strong><xhtml:br/>
                <xhtml:ul>
                    <xhtml:li>be practical and prudent;</xhtml:li>
                    <xhtml:li>provide a clear security benefit; and</xhtml:li>
                    <xhtml:li>do not negatively impact the utility of the technology beyond acceptable means</xhtml:li>
                </xhtml:ul>
            </xhtml:p>
        </xccdf:description>
    </xccdf:Group>
    <xccdf:Group id="scoring-status">
        <xccdf:title>Scoring Status</xccdf:title>
        <xccdf:description>
            <xhtml:p>This section defines the scoring statuses used within this document. The scoring status indicates 
            whether compliance with the given recommendation is discernable in an automated manner. </xhtml:p>
            
            <xhtml:p>
                <xhtml:strong>Scorable</xhtml:strong><xhtml:br/>
                The platform's compliance with the given recommendation can be determined via automated means.
            </xhtml:p>
            
            <xhtml:p>
                <xhtml:strong>Not Scorable</xhtml:strong><xhtml:br/>
                The platform's compliance with the given recommendation cannot be determined via automated means.
            </xhtml:p>
        </xccdf:description>
    </xccdf:Group>
    <xccdf:Group id="Service-Console-or-Hypervisor--Preparation-for-Installation">
        <xccdf:title>Service Console or Hypervisor - Preparation for Installation</xccdf:title>
	<xccdf:description/>
        <xccdf:Rule id="ESX-1.7.1-Validate-System-Before-Making-Changes" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Validate the System before Making Changes</xccdf:title>
            <xccdf:description>
                <xhtml:div> 
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>Equipment where the ESX Host is to be installed should have devices installed, burned in,
                        or other steps completed according to specifications of the hardware manufacturer.  Media containing the 
                        vSphere Server should be verified as unaltered before use in installation.</xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>Hardware or installation software that is altered or damaged in transit from 
                        the vendor can provide an unstable foundation for a vSphere environment, possibly 
                        causing security, performance, or continuity issues post-installation.</xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>Develop documented procedures to follow manufacturer’s recommendations for 
                        pre-installation processes. Verify vendors hash totals of software before installation.</xhtml:p>
                </xhtml:div>
            </xccdf:description>
        </xccdf:Rule>      
        <xccdf:Rule id="ESX-1.7.2-Configure-Firmware-BIOS" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Configure Firmware (BIOS)</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>Disable the server's ability to boot off all non-hard disk 
                        devices, including floppy, CD-ROM, and USB. Configure any required 
                        BIOS passwords in conformance with the organization’s policy.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>Providing access control (see sections 1.4.5 through 1.4.8 for password guidance) to the BIOS and 
                    limiting boot sources can reduce the risk that the host’s BIOS can be insecurely configured or that
                    an organization’s storage or network resources may be accessed by a non-conforming operating system
                    booted from unauthorized media.</xhtml:p> 
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>While the system is booting press the appropriate key to enter the 
                            BIOS configuration, enter a password if required, and navigate to the 
                            menu item that controls the boot sequence and set the boot capability 
                            and boot order to not boot off of removable media. Also, on the BIOS 
                            configuration screens set the BIOS password to the organization’s required level.</xhtml:p>
                </xhtml:div>
            </xccdf:description>
        </xccdf:Rule>   
        <xccdf:Rule id="ESX-1.7.3-Change-the-Default-Credentials-for-Remote-Host-Access" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Change the Default Credentials for Remote Host Access</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>Host hardware with remote access capabilities built into the motherboard
                        (i.e. DRAC, iLO) should have the default credentials changed.</xhtml:p> 
                
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>These remote tools allow the ability to boot the host from 
                        a CD/DVD device attached to a remote client to facilitate installation 
                        when the host is new, but also could be used to install 
                        unauthorized operating systems.</xhtml:p>
                
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>At host boot, enter the appropriate keys (i.e. ctrl + D) 
                        to enter the remote access configuration screen and change the 
                        password to one compliant with your organization’s standards (see sections
                        1.10.4 through 1.10.8 for password guidance) . Also, the network to which 
                        this remote capability is connected should be a management segment limited 
                        to authorized employees.</xhtml:p>
                </xhtml:div>
            </xccdf:description>
        </xccdf:Rule>   
    </xccdf:Group>
    <xccdf:Group id="Service-Console-or-Hypervisor--Installation"> 
        <xccdf:title>Service Console or Hypervisor - Installation</xccdf:title>
         <xccdf:description/>
        <xccdf:Rule id="Segregate-Networks" role="full" selected="false" weight="1.0">
            <xccdf:title>Segregate Management and Virtual Machine Networks</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>The default installation of vSphere places Virtual Machines (VM's) in 
                        a PortGroup (VM Network) on the same virtual switch as the management 
                        PortGroup (Service Console). Furthermore, unencrypted data traffic using iSCSI 
                        protocols and some vSphere functions (VMotion and others), are normally in the 
                        clear and should also be segregated.</xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>The default installation option will combine the Virtual Machine 
                        network with the virtual infrastructure Service Console management network. 
                        These two groups have different audiences, system administrators and end users, 
                        and should be segregated. Failing to segregate this traffic could potentially allow network 
                        access to the Service Console to a wider population of users than just system administrators, 
                        possibly allowing access to sensitive configuration traffic or unencrypted data traffic.</xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                    Review the informational output of the commands below for comparison to your organization's standards.
                Note: if changes have been made to the host settings, consider running the commands 'service mgmt-vmware restart'
                and 'service  vmware-vpxa restart' before running the CIS-CAT tool.  This will update the managment database
                to enable the return of up to date values when using shell commands.  However, these restart commands may 
                re-boot the VM's if they are configured for automatic startup and shutdown.</xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="OR">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list the nics available on this ESX host.">
                            <ecl:command>esxcfg-nics -l </ecl:command>    
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list the virtual software network interfaces available on this ESX host.">
                            <ecl:command>esxcfg-vswif -l</ecl:command>                    
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>  
                <xccdf:check system="http://cisecurity.org/check">                
                    <xccdf:check-content>                    
                        <ecl:shell-command comment="This command will list the virtual network switches available on this ESX host.">
                            <ecl:command>esxcfg-vswitch -l</ecl:command>                     
                        </ecl:shell-command>                   
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command comment="This command will list the PortGroups available on this ESX host.">
                        <ecl:command>vmware-vim-cmd hostsvc/net/info | grep -i 'key = "key-vim.host.PortGroup-' | awk -F"-" '{print $3}' | awk -F"\"" '{print $1}'</ecl:command>     
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                   <xccdf:check-content>
                    <ecl:shell-command comment="This command will list all guests and their network interfaces and each PortGroup that each interface is associated with, based on the contents of each guest's vmx file.">
                        <ecl:command>find /vmfs/volumes/ -name *.vmx | xargs grep -H ".networkName =" | awk -F"/" '{print $NF}' | awk -F"." '{print $1 "\t\t" $3}'</ecl:command>     
                    </ecl:shell-command>
                   </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                  <xccdf:check-content>
                    <ecl:shell-command comment="This command will list all guests that do not have a network interface.">
                        <ecl:command>find /vmfs/volumes/ -name *.vmx | xargs grep -L ".networkName =" | awk -F"/" '{print $NF}' | awk -F"." '{print $1 "\t\t" $3}'</ecl:command>     
                    </ecl:shell-command>
                  </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>
        <xccdf:Rule id="Partition-Disks-to-Avoid-Consumption" role="full" selected="false" weight="1.0">
            <xccdf:title>Partition Disks to Avoid Consumption</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        During installation, the following file system structures should be configured on their
                        own disk partitions with each having a minimum size greater than or equal to 5000 1K-blocks:
                        <xhtml:ul>
                            <xhtml:li>/          5000</xhtml:li>
                            <xhtml:li>/boot      5000</xhtml:li>
                            <xhtml:li>/home      5000</xhtml:li>
                            <xhtml:li>swap</xhtml:li>
                            <xhtml:li>/tmp       5000</xhtml:li>
                            <xhtml:li>/var       5000</xhtml:li>
                            <xhtml:li>/var/core  5000</xhtml:li>
                            <xhtml:li>/var/log   5000</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>                   

                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If these partitions fill up, it can cause a denial of service. The above partitions are in addition
                        to the default /, /boot, swap, and /var/log partitions. Core files, which could be large as they may 
                        result from dump situations, are placed within the /var/core/ directory. In a default partitioning scheme, 
                        these core files can fill up the root partition /. A separate partition for /Home will help ensure excessive
                        user activity, if any, on the host does not fill production partitions. Having /tmp and /var in segregated
                        partitions helps if s system processes generate unanticipated volumes of information.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>If the default partition configuration was used during the installation process, that configuration 
                        process will consume the whole drive leaving no room for the suggested additional partitions. The 
                        affected host must either be reinstalled or an exception to policy granted. Establish installation 
                        procedures or installation scripts to modify the partitions and sizes to the recommendations 
                        during future installations and perform post-construction.</xhtml:p>
                </xhtml:div>               
            </xccdf:description>
            <xccdf:complex-check operator="AND">
               <xccdf:check system="http://cisecurity.org/check">
                   <xccdf:check-content>
                       <ecl:shell-command check="none exist" comment="This command will count the number of recommended                             filesystem partitions on this host, out of the 7 that are specified in the benchmark." success="pass">
                             <ecl:command>df | grep -E '(\/$|\/tmp|\/boot|\/home|\/var|\/var\/log|\/var\/core)' | wc -l | awk '$1 !~ /7/'</ecl:command>
                       </ecl:shell-command>
                   </xccdf:check-content>
               </xccdf:check>
               <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list the filesystem partitions that are present                              on this ESX host that are also recommended on the benchmark.">
                            <ecl:command>df | grep -E '(\/$|\/tmp|\/boot|\/home|\/var|\/var\/log|\/var\/core)'</ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
               </xccdf:check>
               <xccdf:check system="http://cisecurity.org/check">
                   <xccdf:check-content>
                       <ecl:shell-command check="none exist" comment="This command will list the filesystem partition sizes                            that are NOT at least 5000 k in size." success="pass">
                           <ecl:command>df | grep -E '(\/$|\/tmp|\/boot|\/home|\/var|\/var\/log|\/var\/core)' | awk '$2 <![CDATA[<]]> 5000' </ecl:command>
                       </ecl:shell-command>
                   </xccdf:check-content>
               </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>
    </xccdf:Group>
    <xccdf:Group id="Service-Console-or-Hypervisor--Configuration ">
        <xccdf:title>Service Console or Hypervisor - Configuration</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Minimize-Boot-Services" role="full" selected="false" weight="1.0">
            <xccdf:title>Minimize Boot Services</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>Services enabled at ESX host startup should be limited to the vendor’s default services
                        and any authorized exceptions.</xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>Any additional services running on an ESX host beyond, added or omitted, to 
                        the vendor's default configuration, could diminish host performance or introduce an attack vector.
                    </xhtml:p>
                </xhtml:div>
                
                <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                <xhtml:p>
                    The assessor should also run the command 'chkconfig --list | grep on'  and review all services scheduled to start
                    at boot, particularly any services not on the benchmark recommended list of 24 (26 if using vCenter)for approval
                    testing and agreement with the organization's change control documentation
                </xhtml:p>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command will list services that are on the list recommended in the benchmark, but are NOT STARTED at boot." success="pass">
                            <ecl:command> actual=(); actual=( $(chkconfig --list | grep :on | awk '{print $1}') ); good=(acpid auditd crond firewall ip6tables lm_sensors mcstrans mgmt-vmware network restorecond rpcgssd rpcidmapd sfcbd-watchdog slpd sshd syslog usbarbitrator vmware vmware-autostart vmware-late vmware-vmkauthd vmware-vpxa wsman xinetd); unusedgood=(); for g in "${good[@]}"; do skip= ; for a in "${actual[@]}"; do if [[ $g = $a ]]; then { skip=1; break; }; fi; done; [[ -n $skip ]] ||  unusedgood+=($g); done; for u in ${unusedgood[@]}; do echo "Fail: start up service ---   $u   --- is not activated upon host boot.";  done </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command will list services that start at boot, but are NOT RECOMMENDED in the benchmark." success="pass">
                            <ecl:command> good=(acpid auditd crond firewall ip6tables lm_sensors mcstrans mgmt-vmware network restorecond rpcgssd rpcidmapd sfcbd-watchdog slpd sshd syslog usbarbitrator vmware vmware-autostart vmware-late vmware-vmkauthd vmware-vpxa wsman xinetd); actualservices=$(chkconfig --list | grep :on | awk '{print $1}'); flag="fail"; for b in ${actualservices[@]}; do for c in ${good[@]}; do if [ $b == $c ]; then  flag="pass"; fi; done; if [ $flag == "fail" ]; then echo "Fail: the service $b is NOT on the recommended list"; fi; flag="fail"; done</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>   
        <xccdf:Rule id="Configure-NTP" role="full" selected="false" weight="1.0">
            <xccdf:title>Configure NTP</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Add configuration settings to enable system clock synchronization with
                        Network Time Protocol (NTP) server(s).
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Keeping your systems synchronized to a local or remote NTP server ensures log entries 
                        are date and time stamped consistently across systems allowing for accurate event correlation. 
                        This also ensures proper functioning on the system given its interaction to other systems 
                        (e.g. vCenter) and possibly third party tools. The default installation of an ESX host does not
                        configure NTP, since the location of your NTP server varies by organization.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Adding NTP requires enabling the service, allowing the service through the firewall, and 
                        configuring the  NTP client for the type and location of the NTP server. 
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> The CIS-CAT tool will ask you to enter the three IP addresses of your NTP servers.
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Using vCenter, select the host from inventory.</xhtml:li>
                        <xhtml:li>Select the Configuration tab.</xhtml:li>
                        <xhtml:li>Select the Security Profile in the Software panel.</xhtml:li>
                        <xhtml:li>Click the Properties link and in the Firewall Properties pop up window, scroll down the 
                            ungrouped services to NTP Client.</xhtml:li>
                        <xhtml:li>Select the empty check box in front of NTP Client, then click OK and you will be returned to
                            the configuration page where NTP Client is now showing in the Outgoing Connections 
                            list associated with port 123. </xhtml:li>
                        <xhtml:li>Select Time Configuration in the Software panel of the Configuration tab.</xhtml:li>
                        <xhtml:li>Click the Properties link and in the Time Configuration pop up window, click the 
                            Options button. </xhtml:li>
                        <xhtml:li>Select NTP Settings in the left panel,</xhtml:li>
                        <xhtml:li>In the NTP Servers dialog box, use the  button to add the address of an &lt;NTP server&gt;.</xhtml:li>
                        <xhtml:li>Repeat step 9 until three NTP servers are present.</xhtml:li>
                        <xhtml:li>Select the check box Restart NTP service to apply changes and click the OK button.</xhtml:li>
                        <xhtml:li>Click the OK button to close the Time Configuration dialog. On the Configuration panel 
                            you should see the NTP service as running and the three IP addresses you entered</xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine if the NTP service is running." success="pass">
                            <ecl:command>ps aux | grep ntp | grep -v "grep"</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine if the NTP service is allowed outbound through the firewall." success="pass">
                            <ecl:command>esxcfg-firewall \-q ntpClient | grep enabled</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine if the 127.0.0.1 address is set to 'restrict' in /etc/ntp.conf." success="pass">
                            <ecl:command>grep ^restrict[[:space:]]127\.0\.0\.1 /etc/ntp.conf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine if kod nomodify notrap noquery nopeer are set to 'restrict' in /etc/ntp.conf." success="pass">
                            <ecl:command>grep ^restrict[[:space:]]default[[:space:]]kod[[:space:]]nomodify[[:space:]]notrap[[:space:]]noquery[[:space:]]nopeer /etc/ntp.conf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine the NTP configuration file and compare the primary NTP server IP address to the address input by the assessor." success="pass">
                            <ecl:command>grep ^server[[:space:]]${Value:NTP.primary} /etc/ntp.conf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="The Secondary NTP server IP is now evaluated against the organization's address input by the assessor." success="pass">
                            <ecl:command>grep ^server[[:space:]]${Value:NTP.secondary} /etc/ntp.conf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="The Tertiary NTP server IP is now evaluated against the address input by the assessor." success="pass">
                            <ecl:command>grep ^server[[:space:]]${Value:NTP.tertiary} /etc/ntp.conf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine the NTP step-tickers configuration file and compare the primary NTP server IP address to the address input by the assessor." success="pass">
                            <ecl:command>grep ^server[[:space:]]${Value:NTP.primary} /etc/ntp/step-tickers</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="The Secondary NTP server IP in step-tickers is now evaluated against the organization's address input by the assessor." success="pass">
                            <ecl:command>grep ^server[[:space:]]${Value:NTP.secondary} /etc/ntp/step-tickers</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="The Tertiary NTP server IP in step-tickers is now evaluated against the address input by the assessor." success="pass">
                            <ecl:command>grep ^server[[:space:]]${Value:NTP.tertiary} /etc/ntp/step-tickers</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>   
        <xccdf:Rule id="Create-Warning-Banners" role="full" selected="false" weight="1.0">
            <xccdf:title>Create Warning Banners</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Create warning banners for console and remote access.
                    </xhtml:p>                   
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> There are no default warning banners since your organization’s exact wording
                        is unknown to the vendor.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Presenting some sort of statutory warning message prior to the normal user logon 
                        may assist the prosecution of trespassers on the computer system. Changing some of
                        these login banners also has the side effect of hiding OS version information and 
                        other detailed system information from attackers attempting to target specific attacks
                        at a system (though there are other mechanisms available for acquiring this information).
                        Guidelines published by the US Department of Defense require that warning messages include
                        at least the name of the organization that owns the system, the fact that the system is 
                        subject to monitoring and that such monitoring is in compliance with local statutes,
                        and that use of the system implies consent to such monitoring. The organization's local legal
                        counsel and/or site security administrator should review the content of all messages before
                        any system modifications are made, as these warning messages are inherently site-specific.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>Log on to the service console; acquire root privileges and perform the following</xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>
                            Create or edit Message of the Day warning banner.<xhtml:br/> 
                            <xhtml:code>vi /etc/motd</xhtml:code>
                        </xhtml:li>
                        <xhtml:li>
                            Create or edit login warning banner. <xhtml:br/>
                            <xhtml:code>vi /etc/issue</xhtml:code>
                        </xhtml:li>
                        <xhtml:li>
                            Create or edit network login, warning banner.<xhtml:br/>
                            <xhtml:code>vi /etc/issue.net</xhtml:code>
                        </xhtml:li>
                        <xhtml:li>
                            Create or edit the page first displayed when web browsing to the host.  Even though the 
                            vmware-webAccess management functions to the host are disabled by default, the https 
                            service will display the page that allows the downloading of the Virtual Infrastructure 
                            Client (VIC) and would be an appropriate place for a warning banner. <xhtml:br/>
                            <xhtml:code>vi /usr/lib/vmware/hostd/docroot/index.html </xhtml:code>
                        </xhtml:li>
                        <xhtml:li>
                            Create or edit the vCenter warning banner: <xhtml:br/>
                            <xhtml:ol>
                                <xhtml:li>Select the Administration menu name in vCenter.</xhtml:li>
                                <xhtml:li>Select Edit Message of the Day to edit or create the text of 
                                    warning content.</xhtml:li>
                            </xhtml:ol><xhtml:br/>
                            <xhtml:strong>Note:</xhtml:strong> Also, if additional banners are specified in the /etc/ssh/sshd_config file, that  
                        </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="Review this listed contents of the /etc/motd file for agreement with your organization's warning banner composition." success="pass">
                            <ecl:command>cat /etc/motd</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="Review this listed contents of the /etc/issue file for agreement with your organization's warning banner composition." success="pass">
                            <ecl:command>cat /etc/issue</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="Review this listed contents of the /etc/issue.net file for agreement with your organization's warning banner composition." success="pass">
                            <ecl:command>cat /etc/issue.net</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="Review this listed contents of the /usr/lib/vmware/hostd/docroot/index.html  file for agreement with your organization's warning banner composition." success="pass">
                            <ecl:command>cat /usr/lib/vmware/hostd/docroot/index.html | grep -v "^$"</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>   
        <xccdf:Rule id="Maintain-Vendor-Patches" role="full" selected="false" weight="1.0">
            <xccdf:title>Maintain Vendor Patches</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        A formal process for keeping up-to-date with applicable vendor patches is 
                        even more important for the host that services multiple guests.  It is up to the organization
                        to download and install patches in accordance to their policies and any SLA requirements;
                        some patches may require a reboot of the system.  Patches should typically be evaluated 
                        in a test environment, before being implemented into a QA then Production environment. 
                        It is recommended that the VMware Update Manager be used for this purpose.
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> Red Hat operating system patches should 
                        not be applied to the ESX host Console Operating System (COS).        
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Applying vendor supported patches minimizes vulnerabilities and utilizes the vendor’s security research
                        and their product knowledge regarding compatibility of changes with other components of the console
                        operating system.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>If Update Manager is installed, follow the procedures for that application to identify hosts and the 
                        patches needed, then stage and remediate as instructed by that software. 
                    </xhtml:p>
                    <xhtml:p>
                        Log on to the service console; acquire root privileges and perform the following:
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>
                            Run a test install to check dependencies and verify sufficient disk space:<xhtml:br/>
                            <xhtml:code>esxupdate d &lt;url_of_update_repository&gt; --test update </xhtml:code>
                        </xhtml:li>
                        <xhtml:li>
                            Install patches, via the command line, on the ESX host after the patches have been:<xhtml:br/>
                            <xhtml:ul>
                                <xhtml:li>Evaluated as relevant to your organizations environment and prioritized (e.g. wait for 
                                    the next update window or apply immediately.) </xhtml:li>
                                <xhtml:li>Downloaded and unzipped if needed.</xhtml:li>
                                <xhtml:li>Moved to the update repository.</xhtml:li>
                                <xhtml:li>Tested in a non-production environment.</xhtml:li>
                                <xhtml:li>Approved and documented including backup and roll-back plans in accordance with 
                                  your organization's change management policies and procedure.</xhtml:li>
                            </xhtml:ul>
                            <xhtml:p>
                                <xhtml:strong>Note:</xhtml:strong> Some patches require rebooting the guests and or the host. Review each patch for 
                                reboot and other requirements or dependencies and communicate timelines to affected 
                                parties. 
                            </xhtml:p>
                            <xhtml:br/>
                            <xhtml:code>
                                esxupdate d &lt;url_of_update_repository&gt; update 
                            </xhtml:code>
                        </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="OR">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list the VMware version of this ESX host.">
                            <ecl:command>vmware -v</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="The command  esxupdate query  will list the patches applied to this ESX host. (note: the CIS-CAT tool can not list output after 100 lines)">
                            <ecl:command> </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="The command  cat /var/log/vmware/esxupdate.log  will list the patch activity on this ESX host. (note: the CIS-CAT tool can not list output after 100 lines)">
                            <ecl:command> </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="The command  rpm -qa -changelog | grep CVE   will list the CVE's addressed by patch activity on this ESX host. (note: the CIS-CAT tool can not list output after 100 lines)">
                            <ecl:command> </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
             </xccdf:complex-check>  
        </xccdf:Rule>
        <xccdf:Rule id="Utilize-Host-Profiles" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Utilize Host Profiles</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        A vSphere host build, or a variety of risk-based builds, may be created 
                        and implemented on new hosts utilizing Host Profiles, standardizing the construction of
                        new hosts.
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> Host Profiles is not available on all vSphere product versions.        
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Consistent certified automated configurations of similar hosts may reduce errors, 
                        provide a similar security posture and speed deployment. Further, the Host Profiles tool
                        may be used to monitor any host that varies from the standard and assist with the 
                        non-conforming host’s remediation.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        To create a host profile, first build an ESX host according to the organization's standards. 
                        Right click on that golden host in the Inventory panel of vCenter and select "Host Profile",
                        then select “Create Profile from (this) Host”, give the profile a name and description and 
                        click "Next" and "Finish".
                    </xhtml:p>
                    <xhtml:p>To apply a host profile to another host, right click on that additional host in the Inventory panel
                        of vCenter and select "Host Profile", then select "Manage Profile", in 
                        the "Attach profile" pop up panel, select the desired host profile previously 
                        created and click "OK". From that point vCenter will analyze
                        the settings of a host, compare those settings to the chosen profile, 
                        and alert if the host is nonconforming.</xhtml:p>
                </xhtml:div>
            </xccdf:description>
        </xccdf:Rule>
        <xccdf:Rule id="Do-Not-Use-Red-Hat-Based-Vulnerability-Scanners" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Do Not Use Red Hat Based Vulnerability Scanners</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        While it is recommended that Red Hat based operating system scanner not be used
                        to assess the COS, any results provided by those tools should be carefully reviewed.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Scanning tools sometimes report vulnerabilities based on version information collected.
                        If the component or service has been modified, which VMware does with many of the components
                        in the COS, false positives may result, inefficiently consuming resources.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Define assessment procedures that use tools and techniques specifically designed for vSphere 
                        where possible. 
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
        </xccdf:Rule>
        <xccdf:Rule id="Do-Not-Use-Linux-Based-Configuration-Commands" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Do Not Use Linux Based Configuration Commands</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Do not, if present, use Linux or Redhat based configuration commands (i.e.redhat-config, 
                        system-config, authconfig).
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Since many of the components of the COS have been modified by VMware, use of 
                        non-approved configuration tools may degrade host performance or result in a vulnerability.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>Review the current host management documentation and match tools and procedures used to the 
                        tools and procedures authorized by the vendor (vCenter, VIC 
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
        </xccdf:Rule>
        <xccdf:Rule id="Monitor-File-Integrity" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Monitor File Integrity</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Files critical to the configuration and operation of the host should have hash values calculated at 
                        installation, before deployment, and then periodically calculate the current hash value of those 
                        files and compare them to the known good values.  
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Any changes to critical files should be detected, and compared to the organization's 
                        change management records to determine appropriate authorization for the alteration.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        System administrators and information security staff should determine a list of files critical
                        to the security and operation of the host that are not subject to a high rate of automated change
                        (i.e. not log files). Those files should be hashed before deployment and those known good values stored
                        on a non-writeable media for use in checking production host’s values to detect changes.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Audit:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Review procedures to periodically evaluate critical file hashes against the known good values, 
                        the matching of changes to authorization, and the follow-up performed on changes not matching 
                        the authorization records.
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
        </xccdf:Rule>
    </xccdf:Group>
    <xccdf:Group id="Service-Console-or-Hypervisor--Access-Control">
        <xccdf:title>Service Console or Hypervisor - Access Control</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Configure-SSH-Access" role="full" selected="false" weight="1.0">
            <xccdf:title>Configure SSH Access</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Remote shell access to the console operating system should protect both the authentication
                        credentials of the administrator and the content communicated between the ESX host and the administrator
                        using secure shell (SSH). Do not enable Direct Root SSH. Do not enable 
                        direct su to root, only allow sudo
                        (see section 1.4.2).
                    </xhtml:p>
                    <xhtml:p><xhtml:strong>Note:</xhtml:strong> Direct console access should be mitigated with physical security controls. Also, other vendor supplied 
                        remote access tools may rely on the SSL protocol to protect browser based sessions. Review the vendor 
                        recommendations for replacing default, vendor-supplied certificates
                        http://www.vmware.com/pdf/vi_vcserver_certificates.pdf.
                        </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Securing administrator login and communication sessions reduces the chance of unauthorized interception of
                        privileged credentials or sensitive configuration information.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> Make a backup before editing configuration files.
                        <xhtml:br/>
                        If SSH server is not enabled, (it is enabled by default) then:                         
                    </xhtml:p>
                    <xhtml:ul>
                        <xhtml:li>Using vCenter, select the &lt;host&gt; from inventory.</xhtml:li>
                        <xhtml:li>Select the Configuration tab.</xhtml:li>
                        <xhtml:li>Select the Security Profile in the Software panel.</xhtml:li>
                        <xhtml:li>Choose the Properties link and in the Firewall Properties pop up window, scroll down 
                            to the secure shell grouped services to SSH Server.</xhtml:li>
                        <xhtml:li>Select the empty check box in front SSH server, and you will be returned to the 
                            configuration page where SSH Server is now showing in the Outgoing Connections list 
                            associated with port 22.  These steps will both activate the service and open the related 
                            port through the firewall. </xhtml:li>
                        <xhtml:li>Perform the following post-installation actions to secure the SSH (OpenSSH 4.3.p2) service:
                            <xhtml:ul>
                                <xhtml:li>Change to the /etc/ssh directory.</xhtml:li>
                                <xhtml:li>Edit sshd_config.</xhtml:li>
                                <xhtml:li>Set the Protocol token to 2. If it is absent, add and set it.</xhtml:li>
                                <xhtml:li>Set the IgnoreRhosts token to yes. If it is absent, add and set it.</xhtml:li>
                                <xhtml:li>Set the StrictModes token to yes. If it is absent, add and set it.</xhtml:li>
                                <xhtml:li>Set the PermitRootLogin token to no. If it is absent, add and set it.</xhtml:li>
                                <xhtml:li>Set the PermitEmptyPasswords token to no. If it is absent, add and set it.</xhtml:li>
                                <xhtml:li>Set the Banner token to /etc/issue. If it is absent, add and set it.</xhtml:li>
                                <xhtml:li>Save the updated sshd_config file.</xhtml:li>
                                <xhtml:li>Ensure root is the owner of sshd_config and ssh_config. </xhtml:li>
                                <xhtml:li>Ensure write access to sshd_config and ssh_config is limited to the file owner 
                                    root.</xhtml:li>
                            </xhtml:ul>
                        </xhtml:li>
                        <xhtml:li>Perform the following post installation actions to secure system-wide SSH client 
                            configuration (if SSH client is allowed as an exception, in the default ESX configuration SSH 
                            Client is turned off) :
                            <xhtml:ul>
                                <xhtml:li>Change to the /etc/ssh directory.</xhtml:li>
                                <xhtml:li>Edit ssh_config.</xhtml:li>
                                <xhtml:li>Set the Protocol token to 2. If it is absent, add and set it.</xhtml:li>
                                <xhtml:li>Set the Ciphers token to aes256-cbc,aes128-cbc. If it is absent, add and set it.</xhtml:li>
                                <xhtml:li>Save the updated ssh_config file.</xhtml:li>
                            </xhtml:ul>
                        </xhtml:li>
                        <xhtml:li>
                            Perform the following to allow inbound SSH connections through the ESX firewall 
                            <xhtml:ul>
                                <xhtml:li>esxcfg-firewall -e sshServer</xhtml:li>
                            </xhtml:ul>
                        </xhtml:li>
                        <xhtml:li>
                            Perform the following to prevent outbound SSH connections via the ESX firewall 
                            <xhtml:ul>
                                <xhtml:li>esxcfg-firewall -d sshClient</xhtml:li>
                            </xhtml:ul>
                        </xhtml:li>
                    </xhtml:ul>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine if the SSH service is running." success="pass">
                            <ecl:command>ps aux | grep /usr/sbin/sshd | grep -v grep</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine if the SSH Server service is allowed through the firewall." success="pass">
                            <ecl:command>esxcfg-firewall -q sshServer | grep enabled</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine if the SSH Client service is disabled." success="pass">
                            <ecl:command>esxcfg-firewall -q sshClient | grep blocked</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine sshd_config for the Protocol 2 setting." success="pass">
                            <ecl:command>grep -v ^# /etc/ssh/sshd_config | grep "Protocol 2"</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine sshd_config for the IgnoreRhosts yes setting." success="pass">
                            <ecl:command>grep -v ^# /etc/ssh/sshd_config | grep "IgnoreRhosts yes"</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command check="all" comment="This command will examine sshd_config for the StrictModes yes setting." success="pass">
                        <ecl:command>grep -v ^# /etc/ssh/sshd_config | grep "StrictModes yes"</ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine sshd_config for the PermitRootLogin no setting." success="pass">
                            <ecl:command>grep -v ^# /etc/ssh/sshd_config | grep "PermitRootLogin no"</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                         <ecl:shell-command check="all" comment="This command will examine sshd_config for the PermitEmptyPasswords no setting." success="pass">
                              <ecl:command>grep -v ^# /etc/ssh/sshd_config | grep "PermitEmptyPasswords no"</ecl:command>
                         </ecl:shell-command>
                     </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine sshd_config for an active Banner setting (if the banner exists, the file contents need to be examined off-line)." success="pass">
                            <ecl:command>grep -v ^# /etc/ssh/sshd_config | grep "Banner /etc/issue"</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <!-- switching the tests to ssh_config, instead of sshd_config which was tested above-->
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine ssh_config (not sshd_config, that test is above) for the Protocol 2 setting." success="pass">
                            <ecl:command>grep -v ^# /etc/ssh/ssh_config | grep "Protocol 2"</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will examine ssh_config (not sshd_config, that test is above) for the Ciphers setting to aes 128 or 256." success="pass">
                            <ecl:command>grep -v ^# /etc/ssh/ssh_config | grep Ciphers | grep -E '(aes128-cbc|aes256-cbc)'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command will examine ssh_config and sshd_config file ownership by the user root, and list either file if not owned by the user root." success="pass">
                            <ecl:command>ls -l /etc/ssh/ssh*_config | awk '$3 !~ /root/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command will examine ssh_config and sshd_config file ownership by the group sys, and list either file if not owned by the group sys." success="pass">
                            <ecl:command>ls -l /etc/ssh/ssh*_config | awk '$4 !~ /sys/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command will examine ssh_config and sshd_config files write permission is available only to the file owner, and list either file if writeable by the group or other. " success="pass">
                            <ecl:command>find /etc/ssh/ssh*_config ! -perm +u=w -perm +g=w,o=w</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>
        <xccdf:Rule id="Implement-SUDO" role="full" selected="false" weight="1.0">
            <xccdf:title>Implement SUDO</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        SUDO allows non-root or non-administrative users to gain root or administrative access
                        to commands, while providing logging that enhances user accountability.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        SUDO enables associating users with powerful administrative commands and allowing root privileges.
                        Further, SUDO provides logging of those users who access these advanced capabilities.  
                        SUDO is not configured on the default ESX installation, since the account and groups to be included
                        vary by organization.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        General SUDO configuration steps include identification of administrators and users and placing them in groups,
                        assigning the groups to wheel status or assigning the groups to specific commands sets
                        (i.e. such as those in the group that can execute esxcfg-* commands) based on their needs
                        as agreed upon between the system administrators and information security.
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> Any changes to SUDO configurations must be made using the 
                        special editor visudo (not vi).        
                    </xhtml:p>
                    <xhtml:p>Review the output of the command below to validate the groups and owners rights for your organization.</xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
               <xccdf:check-content>
                    <ecl:shell-command comment="List the contents of /etc/sudoers for off-line analysis.">
                        <ecl:command>cat /etc/sudoers</ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Set-File-Permissions" role="full" selected="false" weight="1.0">
            <xccdf:title>Set File Permissions</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Set file permissions on the ESX host for all .vmx configuration files to:
                        <xhtml:ul>
                            <xhtml:li>Deny group write access</xhtml:li>
                            <xhtml:li>Deny other write access</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>
                    <xhtml:p>
                        Set file ownership for all .vmx files to:
                        <xhtml:ul>
                            <xhtml:li>Restrict  owner and group file ownership to root</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>
                    <xhtml:p>
                        Set file permissions for all .vmdk disk files to:    
                        <xhtml:ul>
                            <xhtml:li>Deny group read, write and execute access</xhtml:li>
                            <xhtml:li>Deny other read, write and execute access</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>                    
                    <xhtml:p>
                        Set file ownership for all .vmdk disk files to:
                        <xhtml:ul>
                            <xhtml:li>Restrict owner and group file ownership to root</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>
                    
                    <xhtml:p><xhtml:strong>Note:</xhtml:strong> Many additional files could be 
                        considered for reducing access from the default installed rights 
                        (log files, most files in the /etc/ directory, and others). Each organization’s system administration
                        and information security teams should determine their list of critical files and the appropriate, 
                        individual, group, and other ownership rights, plus the appropriate read, write, and execute permissions
                        for each item on that list.</xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>Limiting file permissions to and ownership of, configuration files helps prevent accidental or malicious
                        changes to the system. Limiting file permissions to and ownership of, virtual disk files helps
                        reduce unauthorized deletion or copying of a resource critical to the guest’s operation.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Log on to the service console; acquire root privileges and perform the following: 
                        <xhtml:ol>
                            <xhtml:li>
                                Set file permissions for user and other to deny write access for all &lt;vmx_file_location&gt; files. 
                                <xhtml:br/>
                                <xhtml:code>chmod go-w &lt;vmdk_file_location&gt;</xhtml:code>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                    <xhtml:p>
                        Log on to the service console; acquire root privileges and perform the following: 
                        <xhtml:ol>
                            <xhtml:li>Set file ownership parameters for owner and group to root for all &lt;vmx_file_location&gt; files:
                                <xhtml:br/>
                                <xhtml:code>chown root:root &lt;vmx_file_location&gt;</xhtml:code>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                    <xhtml:p>
                        Log on to the service console; acquire root privileges and perform the following:
                        <xhtml:ol>
                            <xhtml:li>
                                Set file permissions for user and other to deny read, write and execute access for all 
                                &lt;vmdk_file_location&gt; files. 
                                <xhtml:br/>
                                <xhtml:code>chmod go-rwx &lt;vmdk_file_location&gt; </xhtml:code>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                    <xhtml:p>
                        Log on to the service console; acquire root privileges and perform the following: 
                        <xhtml:ol>
                            <xhtml:li>
                                Set file ownership parameters for owner and group to root for all &lt;vmdk_file_location&gt; files:
                                <xhtml:br/>
                                <xhtml:code>chown root:root &lt;vmdk_file_location&gt;</xhtml:code>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
               <xccdf:complex-check operator="AND"> 
                  <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="If any vmx files in the /vmfs/volumes/ path (recursive) have either group or other (world) write priviledges, the noncompliant guests will be listed below." success="pass">
                            <ecl:command>find /vmfs/volumes/ -name *.vmx -perm +g=w,o=w</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                  </xccdf:check>
                  <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="If any vmdk files in the /vmfs/volumes/ path (recursive) have either group or other (world) read or write or execute priviledges, the noncompliant guests will be listed below." success="pass">
                            <ecl:command>find /vmfs/volumes/ -name *.vmdk ! -perm 600</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                  </xccdf:check>
                  <xccdf:check system="http://cisecurity.org/check">
                        <xccdf:check-content>
                            <ecl:shell-command check="none exist" comment="List any vmx files where 'root' is not the owning user." success="pass">
                                <ecl:command> find /vmfs/volumes/ -name *.vmx ! -user root</ecl:command>
                            </ecl:shell-command>
                        </xccdf:check-content>
                  </xccdf:check>
                  <xccdf:check system="http://cisecurity.org/check">
                        <xccdf:check-content>
                            <ecl:shell-command check="none exist" comment="List any vmx files where 'root' is not the owning group." success="pass">
                                <ecl:command> find /vmfs/volumes/ -name *.vmx ! -group root</ecl:command>
                            </ecl:shell-command>
                        </xccdf:check-content>
                  </xccdf:check>
                  <xccdf:check system="http://cisecurity.org/check">
                        <xccdf:check-content>
                            <ecl:shell-command check="none exist" comment="List vmdk files where 'root' is not the owning user." success="pass">
                                <ecl:command> find /vmfs/volumes/ -name *.vmdk ! -user root</ecl:command>
                            </ecl:shell-command>
                        </xccdf:check-content>
                  </xccdf:check>
                  <xccdf:check system="http://cisecurity.org/check">
                        <xccdf:check-content>
                            <ecl:shell-command check="none exist" comment="List vmdk files where 'root' is not the owning group." success="pass">
                                <ecl:command> find /vmfs/volumes/ -name *.vmdk ! -group root</ecl:command>
                            </ecl:shell-command>
                        </xccdf:check-content>
                  </xccdf:check>
                </xccdf:complex-check> 
        </xccdf:Rule>
        <xccdf:Rule id="Strengthen-Password-Controls-History" role="full" selected="false" weight="1.0">
            <xccdf:title>Strengthen Password Controls - History</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Retain a history of previous passwords used and configure the authentication controls 
                        to validate new passwords against greater than or equal to 10 recently used credentials.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Maintaining a history file containing previously used credentials for each user, along with an access control parameter
                        limits continual reuse of recent passwords. Combined with minimum and maximum password life this control helps maintain
                        password effectiveness.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Log on to the service console; acquire root privileges and perform the following: 
                        <xhtml:ol>
                            <xhtml:li>A password history repository should exist on the vSphere host , but if it does not exist, 
                                then create it: 
                                <xhtml:br/>
                                <xhtml:code>touch /etc/security/opasswd</xhtml:code>
                                <xhtml:br/>
                                Configure the file permissions: 
                                <xhtml:br/>
                                <xhtml:code>chmod 600 /etc/security/opasswd</xhtml:code>
                                <xhtml:br/>
                                Change the file ownership: 
                                <xhtml:br/>
                                <xhtml:code>chown root:root /etc/security/opwasswd</xhtml:code>
                            </xhtml:li>
                            <xhtml:li>Change to the /etc/pam.d directory. </xhtml:li>
                            <xhtml:li>Edit system-auth-generic per item 4 </xhtml:li>
                            <xhtml:li>If absent, add the token remember=10 to the line containing password required 
                                /lib/security/$ISA/pam_unix.so </xhtml:li>
                            <xhtml:li>Save the updated system-auth-generic file. (note: the /etc/pam.d/system-auth-generic 
                                file pertains to all users except the vpx vCenter account, the /etc/pam.d/system-auth-
                                local file pertains to the vpx  vCenter account) </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND"> 
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command check="none exist" comment="The /etc/security/opasswd file should exist and only accessible by its owner." success="pass">
                        <ecl:command>find /etc/security/ -name opasswd ! -perm 600</ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command check="all" comment="The value for password reuse should be greater than or equal to 10." sucess="pass">
                        <ecl:command>grep '^password.*sufficient.*pam_unix.so.*remember='  /etc/pam.d/system-auth-generic | awk -F"remember=" '$2 &gt; 10'</ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
          </xccdf:complex-check> 
        </xccdf:Rule>
        <xccdf:Rule id="Strengthen-Password-Controls-Composition-Strength" role="full" selected="false" weight="1.0">
            <xccdf:title>Strengthen Password Controls - Composition Strength</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Password strength/complexity  requirements:
                        <xhtml:ul>
                            <xhtml:li>Ignored when 1 character class is used.</xhtml:li>
                            <xhtml:li>Ignored when 2 character classes are used.</xhtml:li>
                            <xhtml:li>Ignore passphrases.</xhtml:li>
                            <xhtml:li>Greater than or equal to 12 characters in length when 3 character classes are used.</xhtml:li>
                            <xhtml:li>Greater than or equal to 8 characters in length when 4 character classes are used.</xhtml:li>
                            <xhtml:li>Ignore reuse of any number of characters from the old password unless the new password is exactly the same as the old password.</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The user should create a password that consists of a mix of character classes from the four choices; upper case, lower case, 
                        numeric, or special to reduce the use of common words as passwords and increase the difficulty of an unauthorized user guessing
                        their credential.
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> The default installation of ESX uses the pam_cracklib.so plug-in for password complexity 
                        (default is not configured). This plug-in does not check the root account for complexity. You should use the pam_passwdqc.so 
                        library to handle password complexity for all accounts (including the root account).
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Log on to the service console; acquire root privileges and perform the following: 
                        <xhtml:ol>
                            <xhtml:li>Configure password complexity:
                                <xhtml:br/>
                                <xhtml:code>esxcfg-auth --usepamqc=-1 -1 -1 12 8 -1 </xhtml:code>
                                <xhtml:br/>
                                <xhtml:strong>Note:</xhtml:strong> Setting the value of any of these options to -1 ignores the requirement. Setting any of 
                                these options to disabled disqualifies passwords with the associated characteristic. The 
                                values used must be in descending order except for -1 and disabled. The options for the 
                                command esxcfg-auth --usepamqc=&lt;N0&gt; &lt;N1&gt; &lt;N2&gt; &lt;N3&gt; &lt;N4&gt; &lt;match&gt; are:
                                
                                <xhtml:ul>
                                    <xhtml:li>&lt;N0&gt; # of characters required for passwords using one character classes</xhtml:li>
                                    <xhtml:li>&lt;N1&gt; # of characters required for passwords using two character classes</xhtml:li>
                                    <xhtml:li>&lt;N2&gt; passphrases </xhtml:li>
                                    <xhtml:li>&lt;N3&gt; # of characters required for passwords using three character classes </xhtml:li>
                                    <xhtml:li>&lt;N4&gt; # of characters for passwords using all four character classes </xhtml:li>
                                    <xhtml:li>&lt;match&gt; # of character allowed to be reused from the old password</xhtml:li>
                                </xhtml:ul>      
                                <xhtml:br/>
                                <xhtml:strong>Note:</xhtml:strong> When the esxcfg-auth --usepamqc command sets pam_passwdqc.so as the 
                                complexity control, the pam_cracklib.so plug-in is disabled, as is the 3-attempts control.                                 
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                     <xccdf:check-content>
                         <ecl:shell-command check="all" comment="Using 3 character classes should have the minimum total password length of 12 or greater, and not be disabled." sucess="pass">
                             <ecl:command> grep -i '^password[[:space:]]\+required[[:space:]]\+/lib/security/\$ISA/pam_passwdqc.so' /etc/pam.d/system-auth | awk '{print $4}' | awk -F"," '$4 &gt; 11'| awk -F"," '$4 !~ /disabled/'</ecl:command>
                         </ecl:shell-command>
                     </xccdf:check-content>
                </xccdf:check>     
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="Using 4 character classes should have the minimum total password length of 8 or greater, and should not be disabled." sucess="pass">
                            <ecl:command> grep -i '^password[[:space:]]\+required[[:space:]]\+/lib/security/\$ISA/pam_passwdqc.so' /etc/pam.d/system-auth | awk '{print $4}' | awk -F"," '$5 &gt; 7'| awk -F"," '$5 !~ /disabled/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>     
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="Using 2 character classes should be disabled." sucess="pass">
                            <ecl:command> grep -i '^password[[:space:]]\+required[[:space:]]\+/lib/security/\$ISA/pam_passwdqc.so' /etc/pam.d/system-auth | awk '{print $4}' | awk -F"," '$3~ /disabled/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>     
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="Using 1 character class should be disabled." sucess="pass">
                            <ecl:command> grep -i '^password[[:space:]]\+required[[:space:]]\+/lib/security/\$ISA/pam_passwdqc.so' /etc/pam.d/system-auth | awk '{print $4}' | awk -F"," '$2~ /disabled/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>     
             </xccdf:complex-check>
        </xccdf:Rule>
        <xccdf:Rule id="Strengthen-Password-Controls-Maximum-Days" role="full" selected="false" weight="1.0">
            <xccdf:title>Strengthen Password Controls - Maximum Days</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Set the maximum number of days before a password is required to be changed to
                        <xhtml:ul>
                            <xhtml:li>less than or equal to 90 days.</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Minimizing the life of a credential reduces the likelihood that the password will become compromised.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Log on to the service console, acquire root privileges and perform the following: 
                        <xhtml:ol>
                            <xhtml:li>Set the maximum password life in days in /etc/login.defs to less than or equal to 90 days.
                                <xhtml:br/>
                                <xhtml:code>esxcfg-auth passmaxdays=90</xhtml:code>
                                <xhtml:br/>
                                <xhtml:strong>Note:</xhtml:strong> The above command will not reset the remaining days in any existing user accounts. 
                                Therefore, if an account had more days remaining than the new standard, they retain those 
                                extra days of password life. The change above will be effective at the next time a new 
                                password is changed. Administrators should force service console users (with the 
                                appropriate advance communication) to change their password at the next login with the 
                                command below, thus implementing the new maximum standard. 
                            </xhtml:li>
                            <xhtml:li>
                                Set a number of days since password was last changed <xhtml:strong>for each user account.</xhtml:strong>
                                <xhtml:br/>
                                <xhtml:code>chage d 0 &lt;useraccount&gt;</xhtml:code>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
                <!--/etc/login.defs text content-->
                <xccdf:check-content>
                    <ecl:file-content check="all" comment="Check /etc/login.defs setting for password maximum life of 90 or less.">
                        <ecl:path>/etc/login.defs</ecl:path>
                        <ecl:line-selection op="pm" value="^PASS_MAX_DAYS\s+(\d+)$">
                            <ecl:regex-group dt="xs:integer" group="1" op="le" value="90"/>
                        </ecl:line-selection>
                    </ecl:file-content>
                </xccdf:check-content>
            </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Strengthen-Password-Controls-Minimum-Days" role="full" selected="false" weight="1.0">
            <xccdf:title>Strengthen Password Controls - Maximum Days</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Set the minimum number of days a password must exist before it can be changed to:
                        <xhtml:ul>
                            <xhtml:li>Greater than or equal to 7 days.</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Combined with the password history setting, the minimum days setting will cause multiple days to
                        transpire before a user can return to a favorite password, discouraging password reuse.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Log on to the service console; acquire root privileges and perform the following:
                        <xhtml:ol>
                            <xhtml:li>Set the minimum password life in days in /etc/login.defs to greater than or equal to 7 days.
                                <xhtml:br/>
                                <xhtml:code>esxcfg-auth passmindays=7</xhtml:code>
                            </xhtml:li>
                        </xhtml:ol>                        
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
                    <!--/etc/login.defs text content-->
                    <xccdf:check-content>
                        <ecl:file-content check="all" comment="Check /etc/login.defs setting for password minimum life of 7 or more.">
                            <ecl:path>/etc/login.defs</ecl:path>
                            <ecl:line-selection op="pm" value="^PASS_MIN_DAYS\s+(\d+)$">
                                <ecl:regex-group dt="xs:integer" group="1" op="ge" value="7"/>
                            </ecl:line-selection>
                        </ecl:file-content>
                    </xccdf:check-content>
            </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Strengthen-Password-Controls-Length" role="full" selected="false" weight="1.0">
            <xccdf:title>Strengthen Password Controls - Length</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Set the minimum required number of characters the password length must be to:
                        <xhtml:ul>
                            <xhtml:li>Greater than or equal to 8 characters (12 if only three out of the four character sets are required).</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> esxcfg-auth –passminlen command option has been removed from ESX 4
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The longer the password length the more iterations password guessing technique must process to determine the credential.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Use the pam quality parameters discussed above to set the minimum length for the three and four 
                        classes of characters that comprise the password. Use the command below to set the minimum 
                        password length in characters  
                        <xhtml:br/>
                        <xhtml:code>esxcfg-auth --usepamqc=-1 -1 -1 12 8 -1</xhtml:code>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>        
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="When using 3 character classes, the minimum total password length should be 12 or greater." sucess="pass">
                            <ecl:command> grep -i '^password[[:space:]]\+required[[:space:]]\+/lib/security/\$ISA/pam_passwdqc.so' /etc/pam.d/system-auth | awk '{print $4}' | awk -F"," '$4 &gt; 11'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>     
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="When using 4 character classes, the minimum total password length should be 8 or greater." sucess="pass">
                            <ecl:command> grep -i '^password[[:space:]]\+required[[:space:]]\+/lib/security/\$ISA/pam_passwdqc.so' /etc/pam.d/system-auth | awk '{print $4}' | awk -F"," '$5 &gt; 7'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>     
             </xccdf:complex-check>   
        </xccdf:Rule>
        <xccdf:Rule id="Ensure-Host-Direct-Web-Access-is-Disabled" role="full" selected="false" weight="1.0">
            <xccdf:title>Ensure Host Direct Web Access is Disabled </xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The default setting of vSphere host web access should be retained. This access level allows only
                        the display of the welcome screen with a link to download VMware Infrastructure client and links to VMware sites, 
                        but provides no host or guest management functionality.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Because of the weaknesses of the http protocol and related browsers, as little as possible on the host should be exposed.
                        Administrator’s logins and related traffic are better directed to other more secure access tools and protocols such as
                        VMware infrastructure client and SSH.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The default setting of the service vmware-webAccess should remain off. If the service has been 
                        turned on, use the command below to set the service to not start at boot. 
                        <xhtml:br/>
                        <xhtml:code>chkconfig level 12345 vmware-webAccess off</xhtml:code>
                    </xhtml:p>
                </xhtml:div>               
            </xccdf:description>        
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="The service, vmware-webAccess should not be enabled at any run level." sucess="pass">
                            <ecl:command> chkconfig --list vmware-webAccess | grep on</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>     
        </xccdf:Rule>
        <xccdf:Rule id="ESX-User-Accounts-Not-Synchronized" role="unscored" selected="false" weight="0.0">
            <xccdf:title>ESX User Accounts Not Synchronized</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        User accounts on the ESX host and the vCenter management server are not synchronized in an automated fashion.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        When changes or deletions are required in system administration staff, making alterations on one platform may not completely
                        accomplish the desired result.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        When removing or changing access rights of administrative users, procedures must be in place to
                        determine the need for removal or changes the user's access level of these types of accounts in                         
                        both the ESX host and the vCenter server.  
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>        
        </xccdf:Rule>
        <xccdf:Rule id="Use-vCenter-and-vSphere-Client-for-Administration" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Use vCenter and vSphere Client for Administration</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The vendor supplied tools, vCenter, Command Line Interfaces (CLI) and the VIC directly accessing the host 
                        should be used for making changes on the host rather than commands run on the COS whenever possible.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Vendor designed panels in the tools provide a consistent interface for making changes, and provide information on other items
                        related to the current change being made, all help reduce the chance of error.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Procedural documentation should require the use of vendor tools when making host changes and 
                        documented, approved exceptions when these tools cannot be used. 
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>        
        </xccdf:Rule>
        <xccdf:Rule id="Use-Directory-Service-Authentication" role="full" selected="false" weight="1.0">
            <xccdf:title>Use Directory Service Authentication </xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Use a central repository of authentication controls to grant access to the host.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Host users, usually system administrators, access a variety of machines and applications in addition to the ESX host.  
                        Centralizing the authentication process provides for a consistent application of the organization’s policies regarding
                        credentials and user management.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        After user accounts are created on the host, limited to a small group of host administrators,  
                        configure the host to use a directory service each time those users wish to access the host. Use the 
                        command below to set the vmware-auth service to use a directory service to authenticate users 
                        logging in to the host. 
                        <xhtml:br/>
                        <xhtml:code>esxcfg-auth enabled addomain=&lt;yourdomain&gt;.com   \ <xhtml:br/>
                        addc=&lt;yourdomaincontroller&gt;.&lt;yourdomain&gt;.com </xhtml:code>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                   <ecl:shell-command comment="This command will list the domains and controllers that the ESX host uses for authenticatio, compare the output to your organization's environment.">
                        <ecl:command>esxcfg-auth --probe | grep -A5 realms</ecl:command>    
                   </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>       
        </xccdf:Rule>
        <xccdf:Rule id="Use-vCenter-Automatic-Password-Change-for-vpxuser" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Use vCenter Automatic Password Change for vpxuser</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The password maximum days set on the host for the vpxuser account should be set to a value greater than
                        or equal to the days provided in vCenter for automatically changing the password for vpxuser.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If the host has a shorter password maximum life set with esxcfg-auth, than the vCenter password autochange value,
                        the vpxuser account could get locked out resulting in a denial of access to vCenter to help manage the host.
                        The vpxuser account would then have to be unlocked from the host console to allow vCenter access to manage the host.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        In vCenter, select the host to review in the navigator panel, select "Administration" from the name menu, 
                        select "vCenter Server Settings", then select the "Advanced Settings" item on the left.  Scroll down to the setting 
                        "VirtualCenter.VimPasswordExpirationInDays" and review the key value in the middle column for the correct amount. see also 
                        the result for PASS_MAX_DAYS from the tests in section 4.7 (1.10.7) and ensure that value is greater than or equal to 
                        the value shown in the vCenter steps above, and both values are less than organizational policy or the 90 days recommended
                        in 4.7 (1.10.7).
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
        </xccdf:Rule>
        <xccdf:Rule id="Require-Authentication-for-Single-User-Mode" role="full" selected="false" weight="1.0">
            <xccdf:title>Require Authentication for Single User Mode</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Change the default installation boot configuration of the host to disallow the ability to boot 
                        into single user mode.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The single user boot mode, which is permitted in the default installation of the host, allows whoever enters this
                        mode at the console to have root privileges without having to login and authenticate as root. Since the default
                        installation also does not require a boot loader password (grub), anyone with console access to the host can change to
                        the edit mode of boot loader to direct the host to boot to the single user mode gaining escalated privileges. 
                        (see also 1.12.1 (1.18.1) to configure a boot loader [grub] password).
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        To require a login with appropriate credentials at the single user mode boot levels, add the 
                        following line to the file /etc/inittab :  <xhtml:br/>
                        <xhtml:code>~~:S:wait:/sbin/sulogin</xhtml:code>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command check="all" comment="The configuration for S (single mode sign in) in the initialization table /etc/inittab should be set to /sbin/sulogin for all run levels." sucess="pass">
                        <ecl:command>grep ~~:S:wait:/sbin/sulogin /etc/inittab </ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>     
        </xccdf:Rule>   
        <xccdf:Rule id="Disable-Console-Root-Login" role="full" selected="false" weight="1.0">
            <xccdf:title>Disable Console Root Login </xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Root logins from the console, both attached and remote consoles, should be removed.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Removing root login
                        from the console requires administrators to first identify and authenticate with their personal account, 
                        then use sudo to perform administrative functions. The will enhance accountability because of the logging performed by sudo.
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> the configuration mentioned in this section will not mitigate the vulnerability described in section.
                        1.10.14 (1.4.14) related to booting into the single user mode.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        At least one, or more as appropriate for their duties,  user other than root must be created.
                        <xhtml:br/>
                        <xhtml:code>useradd &lt;newuser&gt;</xhtml:code>
                    </xhtml:p>
                    <xhtml:p>
                        That user(s) must be added to the wheel group. 
                        <xhtml:br/>
                        <xhtml:code>usermod G10 &lt;newuser&gt;</xhtml:code>
                    </xhtml:p>
                    <xhtml:p>
                        The wheel group must be activated. 
                        <xhtml:br/>
                        <xhtml:code>
                            visudo <xhtml:br/>
                            i                       (to insert)<xhtml:br/> 
                            delete the # in front of the command line: # %wheel ALL=(ALL) ALL<xhtml:br/> 
                            press the escape key,  <xhtml:br/>
                        </xhtml:code>
                    </xhtml:p>
                    <xhtml:p>
                        Finally, the sources from where root can log into can be removed (but retain the empty file). 
                        <xhtml:br/>
                        <xhtml:code>
                            cat /dev/null &gt; /etc/securetty 
                        </xhtml:code>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command check="none exist" comment="This command should show an empty securetty file with no terminals in the approved list." sucess="pass">
                        <ecl:command>cat /etc/securetty</ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>     
        </xccdf:Rule>   
    </xccdf:Group>
    <xccdf:Group id="Service-Console-or-Hypervisor--Logging">
        <xccdf:title>Service Console or Hypervisor - Logging</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Establish-Log-Sizes-and-Compression" role="full" selected="false" weight="1.0">
            <xccdf:title>Establish Log Sizes and Compression</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Increase the file size to 2096K and enable compression for the log files vmkwarning,
                        vmkernel and vmksummary.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The larger the log file the more events will be captured to help research system performance or security issues.
                        Compression will allow more events to be captured in the file space provided. With the default history 
                        of 36 logs, the each set of log files will require just under 80 megabytes of storage.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Log on to the service console, acquire root privileges and perform the following:
                        <xhtml:ol>
                            <xhtml:li>
                                Perform the following actions to configure global  log compression and rotation: 
                                <xhtml:ul>
                                    <xhtml:li>Change to the /etc directory</xhtml:li>
                                    <xhtml:li>Open /etc/logrotate.conf file with an editor </xhtml:li>
                                    <xhtml:li>Uncomment the compress token to enable the global log compression, remove the # 
                                        (pound sign). If the compress token is absent, add it. </xhtml:li>
                                    <xhtml:li>Save the updated logrotate.conf file.</xhtml:li>
                                </xhtml:ul>
                            </xhtml:li>
                            <xhtml:li>
                                After host compression is enabled above, perform the following actions to set compression and 
                                log size for the two files /etc/logrotate.d/vmkernel and /etc/logrotate.d/vmksummary :
                                <xhtml:ul>
                                    <xhtml:li>Change to the /etc/logrotate.d directory</xhtml:li>
                                    <xhtml:li>Open vmkernel with an editor</xhtml:li>
                                    <xhtml:li>Change the nocompress option to compress. If it is absent, add it.</xhtml:li>
                                    <xhtml:li>Change the size token to 2096K. If it is absent, add and set it.</xhtml:li>
                                    <xhtml:li>Save the updated vmkernel file.</xhtml:li>
                                    <xhtml:li>Open vmksummary.</xhtml:li>
                                    <xhtml:li>Change the nocompress option to compress. If it is absent, add it.</xhtml:li>
                                    <xhtml:li>Change the size token to 2096K. If it is absent, add and set it.</xhtml:li>
                                    <xhtml:li>Save the updated vmksummary file.</xhtml:li>
                                </xhtml:ul>
                            </xhtml:li>
                            <xhtml:li>
                                Perform the following actions to set compression and log size for the file 
                                /etc/logrotate.d/vmkwarning:
                                <xhtml:ul>
                                    <xhtml:li>Change to the /etc/logrotate.d directory</xhtml:li>
                                    <xhtml:li>Open vmkwarning</xhtml:li>
                                    <xhtml:li>Add the compress option.</xhtml:li>
                                    <xhtml:li>Add the size token 2096K.</xhtml:li>
                                    <xhtml:li>Save the updated vmkwarning file.</xhtml:li>
                                </xhtml:ul>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command checks to see if overall host log compression is turned off." success="pass">
                            <ecl:command>grep ^compress /etc/logrotate.conf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="For the log file vmkernel,  this command checks if 'compress' is present. (with the word option '-w', 'nocompress' will not trigger a match)" success="pass">
                            <ecl:command> grep -v \# /etc/logrotate.d/vmkernel | grep -w compress</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="For the log file vmkernel,  this command checks to see if log size is at least 2096k." success="pass">
                            <ecl:command> grep -v \# /etc/logrotate.d/vmkernel | awk '/size/ {print $2}' | awk -F"k" '$1 &gt; 2095'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="For the log file vmksummary,  this command checks if 'compress' is present. (with the word option '-w', 'nocompress' will not trigger a match)" success="pass">
                            <ecl:command> grep -v \# /etc/logrotate.d/vmksummary | grep -w compress</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="For the log file vmksummary,  this command checks to see if log size is at least 2096k." success="pass">
                            <ecl:command> grep -v \# /etc/logrotate.d/vmksummary | awk '/size/ {print $2}' | awk -F"k" '$1 &gt; 2095'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="For the log file vmkwarning,  this command checks if 'compress' is present. (with the word option '-w', 'nocompress' will not trigger a match)" success="pass">
                            <ecl:command> grep -v \# /etc/logrotate.d/vmkwarning | grep -w compress</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="For the log file vmkwarning,  this command checks to see if log size is at least 2096k." success="pass">
                            <ecl:command> grep -v \# /etc/logrotate.d/vmkwarning | awk '/size/ {print $2}' | awk -F"k" '$1 &gt; 2095'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>
        <xccdf:Rule id="Review-Logs" role="unscored" selected="false" weight="0.0">
            <xccdf:title>Review Logs</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Establish procedures defining the timing of, and the staff responsibility for, log reviews.        
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> Host logs such as those mentioned in section 1.11.1 and messages, secure, and any log files in the
                        /var/log/vmware/ directory, and guest logs stored on the host in /vmfs/volumes/yourstoragedevice /yourguest,
                        and vCenter logs (if in use) may help provide additional research sources related to ESX host analysis.        
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Reviewing logs in a timely manner may detect a performance or security issue in its early stages 
                        enabling the organization to take countermeasures to reduce the event’s impact.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Establish documented review procedures for the logs listed above including: frequency, staff 
                        accountability, content to alert upon, escalation and communication, integration with other 
                        security information management tools and any other procedures. 
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
        </xccdf:Rule>
        <xccdf:Rule id="Configure-syslogd" role="full" selected="false" weight="1.0">
            <xccdf:title>Configure syslogd</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Configure syslogd to send a copy of ESX host logs to a separate hardened host.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Remote logging is essential in detecting intrusion and monitoring multiple servers simultaneously.
                        If an intruder is able to obtain root on a host, they may be able to edit the system logs to remove
                        all traces of the attack.  If a copy of the logs is stored off the machine that cannot be accessed
                        with the compromised host’s credentials, those logs can be analyzed for anomalies and used for prosecuting the attacker.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Log on to the service console; acquire root privileges and perform the following: 
                        <xhtml:ol>
                            <xhtml:li>
                                Perform the following actions to configure logging: 
                                <xhtml:ul>
                                    <xhtml:li>Change to the /etc directory.</xhtml:li>
                                    <xhtml:li>Open syslog.conf with an editor</xhtml:li>
                                    <xhtml:li>Add the name of your log server(s) preceded by an ampersand 
                                        (@&lt;yourlogserver1&gt;) to the end of each line that identifies a log file in the 
                                            /etc/syslog.conf file. </xhtml:li>
                                    <xhtml:li>Save the updated syslog.conf file.</xhtml:li>
                                </xhtml:ul>
                            </xhtml:li>
                            <xhtml:li>
                                Perform the following actions to allow syslog traffic through the firewall, open the standard 
                                port with the commands below:
                                <xhtml:p>
                                    <xhtml:code>esxcfg-firewall -o 514,udp,out,syslog 
                                        esxcfg-firewall -l</xhtml:code>
                                </xhtml:p>
                                <xhtml:p>
                                    <xhtml:strong>Note:</xhtml:strong> Syslog is one service ESX firewall does not have built-in when all known services are 
                                    listed with the esxcfg-firewall s command. 
                                </xhtml:p>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will list which log entries are associated with the remote syslog that was input when CIS-CAT was started." success="pass">
                            <ecl:command>grep \@${Value:remote.logserver} /etc/syslog.conf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will list which log entries are NOT associated with the remote syslog server that was input when CIS-CAT was started. (commented and blank lines are ignored)" success="fail">
                            <ecl:command>grep -Ev '(^#|^\s*$|\@${Value:remote.logserver})' /etc/syslog.conf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command will check to see if the syslog services is allowed through the firewall.  NOTE: syslog is not one of the predefined services in vCenter and does not show up in the output of the esxcfg-firewall -q command under 'Enabled Services', it is listed in the section 'Opened Ports'. Also, review the output for the correct port if your organization does not use default ports." success="pass">
                            <ecl:command>esxcfg-firewall \-q | grep -B 1 syslog</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>   
    </xccdf:Group>
    <xccdf:Group id="Networking--vSwitch-and-PortGroup">
        <xccdf:title>Networking – vSwitch and PortGroup</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Protect-Against-MAC-Address-Spoofing" role="full" selected="false" weight="1.0">
            <xccdf:title>Protect Against MAC Address Spoofing</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Change the setting to Reject for the settings MAC Address Changes for virtual switches and PortGroups.
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> The default setting is accept in virtual switches and in PortGroups for MAC Address Changes.        
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        This setting provides the ability to not execute requests to alter a  guest’s MAC address from the initial MAC address.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        <xhtml:ol>
                            <xhtml:li>Perform the following actions in vCenter to set the MAC address spoofing setting from the 
                                default configuration of Accept (saved as true in the configuration files) to Reject (saved 
                                as false in the configuration files) using vCenter as follows: 
                            
                                <xhtml:ul>
                                    <xhtml:li>Select the &lt;host&gt; in the navigation panel, </xhtml:li>
                                    <xhtml:li>Select the Configuration Tab and click on the Networking link, this will display a
                                        listing of the vSwitches, port groups, physical NICs and the guest association. </xhtml:li>
                                    <xhtml:li>For each virtual switch, click on the properties link: </xhtml:li>
                                    <xhtml:li>In the vSwitch panel select each vSwitch or a PortGroup that needs modification.</xhtml:li>
                                    <xhtml:li>Click on the Edit button.</xhtml:li>
                                    <xhtml:li>Click on the Security tab. 
                                        <xhtml:br/>
                                        <xhtml:p>
                                            <xhtml:strong>Note:</xhtml:strong> The properties of the VSwitch are inherited by the PortGroup unless 
                                            overridden in the PortGroup settings. 
                                        </xhtml:p>
                                    </xhtml:li>
                                    <xhtml:li>Drop down the selector next to "MAC Address Change" and choose Reject instead 
                                        of Accept. </xhtml:li>
                                </xhtml:ul>
                            </xhtml:li>
                            <xhtml:li>
                                Alternatively, change vSwitch, and all the PortGroups within that vSwitch, security policy 
                                settings at the command line using the vimsh command below:  
                                <xhtml:p>
                                    <xhtml:code>vmware-vim-cmd hostscv/net/vswitch_setpolicy --securepolicy-macchange=false 
                                        &lt;yourvswitch&gt; </xhtml:code>
                                </xhtml:p>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command tests for the value 'true' in the MAC address configuration setting, if that value is found at either the vSwitch or PortGroup settings, the vSwitch or PortGroup are listed." success="pass">
                            <ecl:command>vmware-vim-cmd hostsvc/net/info | grep  'macChanges = true'; if [ $? = 0 ]; then  vmware-vim-cmd hostsvc/net/info | grep -E '(name|macChanges|PortGroup-)'; fi</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Protect-Against-Forged-Transmits" role="full" selected="false" weight="1.0">
            <xccdf:title>Protect Against Forged Transmits</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Change the flags to Reject for the settings Forged Transmits for virtual switches and PortGroups.
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> The default setting is accept in virtual switches and in PortGroups for Forged Transmits.        
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        This setting provides the ability to compare the incoming and outgoing guest MAC address in a network packet
                        to the initial MAC address specified in the guest configuration file (.vmx). If the MAC addresses differ, the packet is dropped
                        with the Reject setting.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        <xhtml:ol>
                            <xhtml:li>
                                Perform the following actions in vCenter to set the forged transmits setting from the 
                                default configuration of Accept (saved as true in the configuration files) to Reject (saved 
                                as false in the configuration files) using vCenter as follows: 
                                <xhtml:ul>
                                    <xhtml:li>Select the &lt;host&gt; in the navigation panel, </xhtml:li>
                                    <xhtml:li>Select the Configuration Tab and click on the Networking link, this will display a 
                                        listing of the vswitches, port groups, physical NICs and the guest association. </xhtml:li>
                                    <xhtml:li>For each virtual switch, click on the properties link: </xhtml:li>
                                    <xhtml:li>In the vSwitch panel select each vSwitch or a PortGroup that needs modification. </xhtml:li>
                                    <xhtml:li>Click on the Edit button.</xhtml:li>
                                    <xhtml:li>Click on the Security tab.
                                        <xhtml:p>
                                            <xhtml:strong>Note:</xhtml:strong> The properties of the VSwitch are inherited by the PortGroup unless 
                                            overridden in the PortGroup settings. 
                                        </xhtml:p>
                                    </xhtml:li>
                                    <xhtml:li>Drop down the selector next to "Forged Transmits:" and choose Reject instead of 
                                        Accept. </xhtml:li>
                                </xhtml:ul>
                            </xhtml:li>
                            <xhtml:li>
                                Alternatively, change vSwitch, and all the PortGroups within that vSwitch, security policy 
                                settings at the command line using the vimsh command below, replacing the [OPTIONS] 
                                with:
                                
                                <xhtml:p>
                                    <xhtml:code>vmware-vim-cmd hostscv/net/vswitch_setpolicy --securepolicy-forgedxmit=false 
                                        &lt;yourvswitch&gt; </xhtml:code>
                                </xhtml:p>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command check="none exist" comment="This command tests for the value 'true' in the forgedTransmits configuration settings, if any are found all vSwitch and PortGroup settings containing this noncompliant configuration are listed." success="pass">
                        <ecl:command>vmware-vim-cmd hostsvc/net/info | grep 'forgedTransmits = true'; if [ $? = 0 ]; then  vmware-vim-cmd hostsvc/net/info | grep -E '(name|forgedTransmits|PortGroup-)'; fi</ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Protect-Against-Promiscuous-Mode" role="full" selected="false" weight="1.0">
            <xccdf:title>Protect Against Promiscuous Mode</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Ensure the Reject default setting for promiscuous mode has not been modified for virtual switches and PortGroups.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The Accept setting provides the ability, for guests utilizing that PortGroup or vSwitch, to inspect packets not intended for that guest. 
                        For any security software in a guest that needs promiscuous mode to perform its monitoring function, ensure the guests utilizing 
                        the promiscuous PortGroup or vSwitch are authorized exceptions and the Accept setting is reflected in the approved and documented
                        change control process.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        <xhtml:ol>
                            <xhtml:li>
                                If an approved authorized exception is needed for a guest functioning as a security device, 
                                perform the following actions in vCenter to change the Promiscuous Mode setting from the 
                                default configuration of Reject (saved as false in the configuration files) to Accept (saved 
                                as true in the configuration files) using vCenter as follows: 
                                <xhtml:ul>
                                    <xhtml:li>Select the &lt;host&gt; in the navigation panel, </xhtml:li>
                                    <xhtml:li>Select the Configuration Tab and click on the Networking link, this will display a 
                                        listing of the vSwitches, port groups, physical NICs and the guest association. </xhtml:li>
                                    <xhtml:li>For each virtual switch, click on the properties link:</xhtml:li>
                                    <xhtml:li>In the vSwitch panel select each vSwitch or a PortGroup that needs modification. </xhtml:li>
                                    <xhtml:li>Click on the Edit button. </xhtml:li>
                                    <xhtml:li>Click on the Security tab. 
                                        <xhtml:p>
                                            <xhtml:strong>Note:</xhtml:strong> The properties of the VSwitch are inherited by the PortGroup unless 
                                            overridden in the PortGroup settings. 
                                        </xhtml:p>
                                    </xhtml:li>
                                    <xhtml:li>Drop down the selector next to "Promiscuos Mode" and choose Accept instead of 
                                        Reject. </xhtml:li>
                                </xhtml:ul>
                            </xhtml:li>
                            <xhtml:li>
                                Alternatively, change vSwitch, and all the PortGroups within that vSwitch, security policy 
                                settings at the command line using the vimsh command below, replacing the [OPTIONS] 
                                with --securepolicy-promisc=true:
                                <xhtml:p>
                                    <xhtml:code>vmware-vim-cmd hostscv/net/vswitch_setpolicy --securepolicy-promisc=true &lt;yourvswitch&gt;</xhtml:code>
                                </xhtml:p>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command check="none exist" comment="This command tests for the value 'true' in the Promiscuous Mode configuration settins, if any are found all vSwitch and PortGroup settings containing this noncompliant configuration are listed." success="pass">
                        <ecl:command>vmware-vim-cmd hostsvc/net/info | grep 'allowPromiscuous = true'; if [ $? = 0 ]; then  vmware-vim-cmd hostsvc/net/info | grep -E '(name|allowPromiscuous|PortGroup-)'; fi</ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
        </xccdf:Rule>
    </xccdf:Group>
    <xccdf:Group id="Networking--Firewall">
        <xccdf:title>Networking - Firewall</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Configure-Firewall-to-Allow-Only-Authorized-Traffic" role="full" selected="false" weight="1.0">
            <xccdf:title>Configure Firewall to Allow Only Authorized Traffic</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Configure the built-in firewall to ensure only authorized ports and related network traffic
                        sources are allowed to and from the ESX host. 
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> In vCenter the known services can be managed along with their port numbers per the list below.  
                        However, firewall rules can be set outside of vCenter to enable services and ports that will not be displayed
                        in vCenter (see section 1.5.3 [1.11.3] regarding the syslogd service). Also, some services managed by vCenter
                        will vary based on ESX host product levels (for example faultTolerance).
                    </xhtml:p>
                    <xhtml:table>
                        <xhtml:tr>
                            <xhtml:td>activeDirectorKerberos</xhtml:td>
                            <xhtml:td>caARCserve</xhtml:td>
                            <xhtml:td>CIMHttpServer</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>CIMHttpsServer</xhtml:td>
                            <xhtml:td>CIMSLP</xhtml:td>
                            <xhtml:td>commvaultDynamic</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>commvaultStatic</xhtml:td>
                            <xhtml:td>esxupdate</xhtml:td>
                            <xhtml:td>faultTolerance</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>ftpClient</xhtml:td>
                            <xhtml:td>ftpServer</xhtml:td>
                            <xhtml:td>httpClient</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>kerberos</xhtml:td>
                            <xhtml:td>LDAP</xhtml:td>
                            <xhtml:td>LDAPS</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>legatoNetWorker</xhtml:td>
                            <xhtml:td>nfsClient</xhtml:td>
                            <xhtml:td>nisClient</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>ntpClient</xhtml:td>
                            <xhtml:td>smbClient</xhtml:td>
                            <xhtml:td>snmpd</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>sshClient</xhtml:td>
                            <xhtml:td>sshServer</xhtml:td>
                            <xhtml:td>swISCSIClient</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>symantecBackupExec</xhtml:td>
                            <xhtml:td>symantecNetBackup</xhtml:td>
                            <xhtml:td>telnetClient</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>TSM	(TivoliStorage)</xhtml:td>
                            <xhtml:td>updateManager</xhtml:td>
                            <xhtml:td>VCB</xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                            <xhtml:td>vncServer</xhtml:td>
                            <xhtml:td>vpxHeartbeats</xhtml:td>
                            <xhtml:td>webAccess</xhtml:td>
                        </xhtml:tr>
                    </xhtml:table>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If the firewall has not started or if unauthorized ports are opened to the ESX host by a firewall change, 
                        traffic containing disruptive or malicious payloads may negatively impact the host’s performance or security.
                    </xhtml:p>
                                       
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        <xhtml:ol>
                            <xhtml:li>
                                Using vCenter: 
                                <xhtml:ul>
                                    <xhtml:li>Selecting the &lt;host&gt; in the navigation panel.</xhtml:li>
                                    <xhtml:li>Selecting the Configuration Tab and click on Security Profile. </xhtml:li>
                                    <xhtml:li>Select the Properties link.</xhtml:li>
                                    <xhtml:li>Navigate to the Remote Access panel. </xhtml:li>
                                    <xhtml:li>Check to enable or uncheck to disable the boxes in front of the services to allow or 
                                        block related ports in the firewall based on the recommended services in the figure 
                                        above. </xhtml:li>
                                </xhtml:ul>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                    <xhtml:p>
                        Alternatively:
                        <xhtml:br/>
                        Log on to the service console; acquire root privileges and perform the following: 
                        <xhtml:ol>
                            <xhtml:li>
                                Enable known services defined in the list above by configuring the firewall. 
                                <xhtml:p>
                                    <xhtml:code>esxcfg-firewall e &lt;servicename&gt; </xhtml:code>
                                </xhtml:p>
                            </xhtml:li>
                            <xhtml:li>
                                Disable known services not defined in the figure above by configuring the firewall. 
                                <xhtml:p>
                                    <xhtml:code>esxcfg-firewall d &lt;servicename&gt; </xhtml:code>
                                </xhtml:p>
                            </xhtml:li>
                            <xhtml:li>
                                If the service you wish to enable is not on the esxcfg-firewall list above (esxcfg-
                                firewall s), it can be enabled with the open parameter of the command as shown below 
                                for example for syslogd services (see also section 1.5.3) that are not one of the predefined 
                                services. 
                                <xhtml:p>
                                    <xhtml:code> # Example:  esxcfg-firewall -o 514,udp,out,syslog </xhtml:code>
                                </xhtml:p>
                            </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">    
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list the Enables services passing through the firewall, compare to your organization's approved list.">
                            <ecl:command> esxcfg-firewall -q | grep "Enabled services"</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list any services, not controlled by vCenter, that are allowed through the firewall.">
                            <ecl:command> esxcfg-firewall -q | grep -E '(Opened ports|Added Iprules)'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command checks for any changes made to the /etc/sysconfig/iptables.config (IP version4)file, there should be exactly 8 uncommented, nonblank lines." success="pass">
                            <ecl:command> grep -Ev '^#|^$' /etc/sysconfig/iptables-config | wc -l | awk '$1 !~ /8/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command checks for any changes made to the /etc/sysconfig/iptables.config (IP version4)file the 8 lines should contain exactly the 8 search strings in the command below." success="pass">
                            <ecl:command>  grep -E '(IPTABLES_MODULES=""|IPTABLES_MODULES_UNLOAD="yes"|IPTABLES_SAVE_ON_STOP="no"|IPTABLES_SAVE_ON_RESTART="no"|IPTABLES_SAVE_COUNTER="no"|IPTABLES_STATUS_NUMERIC="yes"|IPTABLES_STATUS_VERBOSE="no"|IPTABLES_STATUS_LINENUMBERS="yes")' /etc/sysconfig/iptables-config  | wc -l | awk '$1 !~ /8/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="For IPV6, this command checks for any changes made to the /etc/sysconfig/iptables.config file, there should be exactly 8 uncommented, nonblank lines." success="pass">
                            <ecl:command> grep -Ev '^#|^$' /etc/sysconfig/ip6tables-config | wc -l | awk '$1 !~ /8/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command checks the /etc/sysconfig/ip6tables.config file for the correct 8 lines per the strings in the command below." success="pass">
                            <ecl:command>grep -E '(IP6TABLES_MODULES=""|IP6TABLES_MODULES_UNLOAD="yes"|IP6TABLES_SAVE_ON_STOP="no"|IP6TABLES_SAVE_ON_RESTART="no"|IP6TABLES_SAVE_COUNTER="no"|IP6TABLES_STATUS_NUMERIC="yes"|IP6TABLES_STATUS_VERBOSE="no"|IP6TABLES_STATUS_LINENUMBERS="yes")' /etc/sysconfig/ip6tables-config | wc -l | awk '$1 !~ /8/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
              </xccdf:complex-check>  
        </xccdf:Rule>   
    </xccdf:Group>
    <xccdf:Group id="Networking--Other">
        <xccdf:title>Networking - Other</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Ensure-All-Host-Browser-Sessions-are-https" role="full" selected="false" weight="1.0">
            <xccdf:title>Ensure All Host Browser Sessions are https</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        By default all browser sessions with the host are initiated with a secure protocol (HTTPS)
                        using SSL.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If this session protection is not used, sensitive authentication or configuration information may be
                        intercepted between the administrator’s endpoint and the ESX host.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        None, by default SSL is enabled, see the audit section for confirmation. 
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">   
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command checks for any changes made to the ssl tags in /etc/vmware/ssl/config.xml file, there should be exactly 4 lines matching the search strings in the command below. If there are more or less than 4 lines, the changes to this config file should be traced to the organization's change control documentation." success="pass">
                            <ecl:command> grep -E '(doVersionCheck&gt; false|useCompression&gt;true|privateKey&gt;/etc/vmware/ssl/rui.key|certificate&gt;/etc/vmware/ssl/rui.crt)'  /etc/vmware/hostd/config.xml | wc -l | awk '$1 !~ /4/'</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>             
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list the content between the xml comment markers. Review the content between the markers to ensure required parameters have not been disabled. (i.e. locale information is commented out by default)">
                            <ecl:command>  awk '/&lt;!--/, $NF ~ /--&gt;/ ' /etc/vmware/hostd/config.xml</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>   
            </xccdf:complex-check>   
        </xccdf:Rule>  
        <xccdf:Rule id="Ensure-All-Host-Port-Groups-are-In-Use" role="full" selected="false" weight="1.0">
            <xccdf:title>Ensure All Host Port Groups are In Use</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Multiple PortGroups (512 per virtual standard switch) and multiple ports 
                        (1,016 active ports per host) allow for the flexibility to configure more networking than
                        may be required.        
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Extra or dormant network objects could lead to errors in deployment and misconnection
                        within the organization’s network.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        In vCenter for each host in the "Configuration" tab, select all virtual switches, and all PortGroups
                        on each host and compare to the organization's authorized network structure for any extra paths.
                        If any virtual switches or PortGroups need correction, select the "Properties" blue link and remove
                        any unneeded components.
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description> 
            <xccdf:complex-check operator="AND">
             <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This series of commands, builds an array of known host portgroups, builds an array of *.vmx configurations files with the full path location, uses the vmx array to examine each vmx file for VM portgroup names to build a third array.  The first and thrid arrays are compared and any unmatched host portgroups (other than Servics Console [ServiceConsole after blanks are stripped from portgroup names] are listed." success="pass">
                            <ecl:command> hostportgroups=(); hostportgroups=( $(vim-cmd hostsvc/net/info | grep  ':key-vim.host.PortGroup-' | awk -F'-' '{print $3}' | awk -F'&gt;' '{print $1}' | sed 's/ //g') ); vmx_list=(); vmx_list=( $(find /vmfs/volumes/ -name *.vmx) ); vmportgroups=(); vmportgroups=( $(for v in ${vmx_list[@]}; do grep ".networkName =" $v | awk -F'"' '{print $2}' | sed 's/ //g'; done) ); unusedportgroups=(); for h in "${hostportgroups[@]}"; do skip= ; for v in "${vmportgroups[@]}"; do if [[ $v = $h ]]; then { skip=1; break; }; fi; done; [[ -n $skip ]] ||  unusedportgroups+=($h); done; for u in ${unusedportgroups[@]}; do  if [ $u != 'ServiceConsole' ]; then echo "Fail: host port group ---   $u   --- is not used by any guests."; fi;  done  </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
             </xccdf:check>
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command check="none exist" comment="This series of commands, lists VM port groups that are unused." success="pass">
                        <ecl:command> hostportgroups=(); hostportgroups=( $(vim-cmd hostsvc/net/info | grep  ':key-vim.host.PortGroup-' | awk -F'-' '{print $3}' | awk -F'&gt;' '{print $1}' | sed 's/ //g') ); vmx_list=(); vmx_list=( $(find /vmfs/volumes/ -name *.vmx) ); vmportgroups=(); vmportgroups=( $(for v in ${vmx_list[@]}; do grep ".networkName =" $v | awk -F'"' '{print $2}' | sed 's/ //g'; done) ); unusedportgroups=(); for v in "${vmportgroups[@]}"; do skip= ; for h in "${hostportgroups[@]}"; do if [[ $h = $v ]]; then { skip=1; break; }; fi; done; [[ -n $skip ]] ||  unusedportgroups+=($v); done; for u in ${unusedportgroups[@]}; do  if [ $u != 'ServiceConsole' ]; then echo "Fail: Guest (VM) port group ---   $u   --- is not defined on the host."; fi;  done  </ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>   
        <xccdf:Rule id="Avoid-Conflicting-VLAN-Numbering" role="full" selected="false" weight="1.0">
            <xccdf:title>Avoid Conflicting VLAN Numbering</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        External networking devices handle native traffic that is not on a specified VLAN
                        and may specify a VLAN number, for example “1”, to be associated with such traffic. Generally 
                        external networking devices do not place a VLAN tag inside the packets on this path. Virtual switch
                        PortGroups can be configured to use the same VLAN number as the external native VLAN number, 
                        but will place VLAN tags in the packet.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If VLAN numbers internally in a vSwitch PortGroup, conflict with the external switch native
                        VLAN numbers, the mixture of tagged and un-tagged packets will not be delivered.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Review the configuration of external switches that are connected to an uplink from a virtual 
                        switch and note that external VLAN number used for native traffic. In vCenter for each host, from
                        the "Configuration" tab, select "Networking" link in the "Hardware" section.
                        For each vSwitch, select the "Properties" link. In the "&lt;yourvswitch&gt; Properties" 
                        panel select each PortGroup and review the number (if any) next to "VLAN ID:". If that number conflicts
                        with the external native VLAN number, click on the "Edit" button at the bottom to make changes.                        
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description> 
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list the VLAN Id's in use on the host. Compare this list to your organization's VLAN numbering scheme for any potential mis-allignment.">
                            <ecl:command>  vim-cmd /hostsvc/net/info | grep -B 1  vlanId </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule> 
        <xccdf:Rule id="Match-vSwitch-VLAN-Numbering-to-Physical-Switch-Trunk-Ports" role="full" selected="false" weight="1.0">
            <xccdf:title>Match vSwitch VLAN Numbering to Physical Switch Trunk Ports</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        There is no mechanism to automatically synchronize numbering of VLANs inside 
                        virtual switch PortGroups, with VLAN numbers configured on external physical switches trunk ports.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If internal PortGroup VLAN numbers are not configured with the same VLAN numbers on the linked
                        external physical switch, traffic may not get routed. If extra VLANs are available on the external
                        physical switch, connections may be made to paths that are not of the intended risk or 
                        security classification.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Review the configuration of external switches that are connected to an uplink from a virtual 
                        switch and note that external VLAN numbers configured to the trunk port. In vCenter 
                        for each host, from the "Configuration" tab, select "Networking"
                        link on the "Hardware" section. For each vSwitch, select the "Properties"
                        link in the "&lt;yourswitch&gt; Properties" panel select each PortGroup and review
                        the number (if any) next to "VLAN ID:". The VLAN numbers from all of the PortGroups 
                        should exactly match the list of VLANs configured on the external switch trunk port where the
                        vSwitch uplinks.
                    </xhtml:p>
                    
                    <xhtml:p>
                        If the two VLAN number lists are not exactly equal, assuming the internal virtual VLAN list is 
                        correct, see the external physical switch vendor documentation on how to increase or decrease 
                        the VLAN numbers associated with the trunk port to which this vSwitch uplinks.  
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description> 
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command comment="This command will list the VLAN Id's in use on the host. Compare this list to the external physical switch trunk ports for congruence.">
                        <ecl:command>  vim-cmd /hostsvc/net/info | grep -B 1  vlanId </ecl:command>
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
        </xccdf:Rule> 
    </xccdf:Group>
    <xccdf:Group id="Storage">        
        <xccdf:title>Storage</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Use-Bi--directional-Chap-Authentication-for-ISCSI-Devices" role="full" selected="false" weight="1.0">
            <xccdf:title>Use Bi-directional Chap Authentication for ISCSI Devices</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Configure connections to iSCSI storage devices to use the CHAP protocol
                        for both authentication of the target storage devices to the host initiator, and 
                        to authenticate the host initiator to the storage target.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Use of the CHAP protocol ensures ESX hosts and storage devices are communicating 
                        with known endpoints.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Perform the following to enable CHAP in vCenter:  
                        <xhtml:ol>
                            <xhtml:li>Select the &lt;host&gt; from inventory. </xhtml:li>
                            <xhtml:li>Select the Configuration tab.</xhtml:li>
                            <xhtml:li>Then select the Storage Adapters in the Hardware panel.</xhtml:li>
                            <xhtml:li>Chose the &lt;iSCSI adapter number&gt; in the blue Properties link and in the iSCSI Initiator 
                                Properties panel </xhtml:li>
                            <xhtml:li>In the General tab, Select the CHAP button.</xhtml:li>
                            <xhtml:li>In the CHAP Credentials panel.  </xhtml:li>
                            <xhtml:li>Enter the CHAP Credentials (the host authenticates to the storage target) </xhtml:li>
                            <xhtml:li>Enter the Mutual CHAP Credentials (the storage target authenticates to the host) and 
                                click OK </xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="This command checks to see if iSCSI Client is allowed throught the firewall." success="pass">
                            <ecl:command>esxcfg-firewall -q | grep "Enabled services" | grep swISCSIClient </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="Also check that CHAP Authentication 'true' is turned on, if the iSCSI services is enabled through the firewall." success="pass">
                            <ecl:command> esxcfg-firewall -q | grep "Enabled services" | grep swISCSIClient; if [ $? == 0 ]; then vmware-vim-cmd hostsvc/storage/info | grep "chapAuthEnabled = true"; fi</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="all" comment="Also check that Mutual CHAP Authentication 'chapRequired' is turned on." success="pass">
                            <ecl:command>  esxcfg-firewall -q | grep "Enabled services" | grep swISCSIClient; if [ $? == 0 ]; then vmware-vim-cmd hostsvc/storage/info | grep 'mutualChapAuthenticationType = "chapRequired"'; fi </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>  
        <xccdf:Rule id="Do-Not-Include-a-Service-Console-Portgroup-on-an-iSCSI-vSwitch" role="full" selected="false" weight="1.0">
            <xccdf:title>Do Not Include a Service Console Portgroup on an iSCSI vSwitch</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Do not add a Service Console  network PortGroup to the vSwitch communicating 
                        with the iSCSI storage.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        In prior versions of the ESX host, the vSwitch handling iSCSI traffic, which by default was
                        the PortGroup VMkernel that handled data traffic, also needed to have a Service Console
                        PortGroup on the same vSwitch to handle messaging traffic between the host and the storage device.
                        With ESX 4, all traffic types can be handled by the VMkernel PortGroup.  Removing the second 
                        Service Console PortGroup removes an unneeded path into the COS.        
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If a vSwitch designed to handle iSCSI traffic has a Service Console PortGroup, in vCenter: 
                        <xhtml:ol>
                            <xhtml:li>In vCenter, select the host, and click on the Configuration tab </xhtml:li>
                            <xhtml:li>Select Networking from the hardware list </xhtml:li>
                            <xhtml:li>Scroll to the vSwitch handling the iSCSI traffic, if that vSwitch has unneeded PortGroups,  
                                select Properties </xhtml:li>
                            <xhtml:li>On the left, select the unneeded PortGroup </xhtml:li>
                            <xhtml:li>Click on the Remove button at the bottom</xhtml:li>
                        </xhtml:ol>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="The following command will list the virtual switches and their port groups. Review the output to identify which virual switch handles iSCSI traffic, then review the PortGroups under that switch to ensure 'Service Console' is NOT on the iSCSI virtual switch.">
                            <ecl:command> vim-cmd /hostsvc/net/info | grep -E '(key-vim.host.VirtualSwitch-|key-vim.host.PortGroup-)' </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>  
        <xccdf:Rule id="Use-a-Unique-CHAP-Secret-for-Each-Host" role="full" selected="false" weight="1.0">
            <xccdf:title>Use a Unique CHAP Secret for Each Host</xccdf:title>
            <xccdf:description>  
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The secret used by the host to authenticate itself to the iSCSI target should 
                        be different for each host.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If the password were known to other hosts, those hosts could impersonate the correct host
                        and possibly gain unauthorized access to data. 
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Build procedures for setting up hosts should include instructions not to use a common secret for 
                        Chap authentication. 
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="iSCSI passwords are masked 'XXX...XXX' on the host and even the hash can not be displayed.">
                            <ecl:command> </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Disable-the-Managed-Object-Browser" role="full" selected="false" weight="1.0">
            <xccdf:title>Disable the Managed Object Browser</xccdf:title>
            <xccdf:description>  
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The Managed Object Browser enumerates the VMware Web Services System Development 
                        Kit (SDK) inventory using a browser.  Resources, objects, and settings related to a host can be 
                        viewed and possibly changed with this tool.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Using this browser tool does not enforce the roles and access controls present when using the
                        vCenter Server with the VI Client. By default, the managed object browser is enabled.  
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Log in to the ESX service console and backup the proxy.xml configuration file located in the 
                        /etc/vmware/hostd directory. 
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:code>cp /etc/vmware/hostd/proxy.xml /etc/vmware/hostd/proxy.xml.old</xhtml:code>
                    </xhtml:p>
                    <xhtml:p>
                        Edit the file /etc/vmware/hostd/proxy.xml  with the vi editor. Reduce the length value 
                        &lt;_length&gt;10&lt;/length&gt;  on line three of the file by 1 (default value is ten, if no other modifications 
                            have been made, the new value will be 9). 
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:code>vi /etc/vmware/hostd/proxy.xml <xhtml:br/>
                            i <xhtml:br/>
                            &lt;_length&gt;9&lt;/length&gt; </xhtml:code>
                    </xhtml:p>
                    <xhtml:p>
                        Comment out the section of the file related to the tags &lt;e id="3"&gt; and &lt;/e&gt;, unless the file has 
                        been modified the id will equal 3 and the lines will look like the following after the edit: 
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:code>
                            &lt;!<xhtml:br/> 
                            &lt;e id="3"&gt;<xhtml:br/> 
                            &lt;_type&gt;vim.ProxyService.NamedPipeServiceSpec&lt;/_type&gt;<xhtml:br/> 
                            &lt;accessMode&gt;httpsWithRedirect&lt;/accessMode&gt; <xhtml:br/>
                            &lt;pipeName&gt;/var/run/vmware/proxy-mob&lt;/pipeName&gt; <xhtml:br/>
                            &lt;serverNamespace&gt;/mob&lt;/serverNamespace&gt; <xhtml:br/>
                            &lt;/e&gt; <xhtml:br/>
                            --&gt;  <xhtml:br/>
                        </xhtml:code>
                    </xhtml:p>
                    <xhtml:p>
                        When saving the file, place the override symbol "!" after :wq when 
                        exiting the editor since this is a read-only file. 
                    </xhtml:p>
                    <xhtml:p>
                        Restart management services for the change to take effect.<xhtml:br/>
                        <xhtml:code>
                            service  mgmt-vmware restart <xhtml:br/>
                            service  vmware-vpxa restart 
                        </xhtml:code>
                    </xhtml:p>
                    
                    <xhtml:p>
                        <xhtml:strong>Note:</xhtml:strong> A separate benchmark will be developed for vCenter. vCenter also has managed object 
                        browser capability that should be disabled for the same reasons it is on the host. To change the 
                        setting on the vCenter server, the vpxd.cfg file is located on the VMware vCenter Server by default 
                        at: 
                    </xhtml:p>
                    <xhtml:p>
                        %ALLUSERPROFILE%\Application Data\VMware\VMware VirtualCenter\vpxd.cfg 
                    </xhtml:p>
                    <xhtml:ul>
                        <xhtml:li>On Windows Server 2008, this would generally be C:\ProgramData\VMware\VMware 
                        VirtualCenter\vpxd.cfg </xhtml:li>
                        <xhtml:li>On Windows Server 2003, this would generally be 
                            C:\Documents and Settings\All Users\Application Data\VMware\VMware 
                            VirtualCenter\vpxd.cfg 
                        </xhtml:li>
                    </xhtml:ul>
                    <xhtml:p>
                        Using Wordpad or another editor, add the following line to the file vpxd.cfg, between the tags 
                        &lt;vpxd&gt; and &lt;/vpxd&gt;: 
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:code>&lt;enableDebugBrowse&gt;false&lt;enableDebugBrowse/&gt;</xhtml:code>
                    </xhtml:p>
                    <xhtml:p>
                        Use Windows' services.msc program from the vCenter server command line, locate the VMware
                        VirtualCenter Management Webservices service, and chose restart. 
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="If this command produces output, then there are mob entries from the proxy.xml configuration file that are NOT between commants &lt;!--  and --&gt; and therefore managed object browser may be active." success="pass">
                            <ecl:command> mobentries=(); mobentries=( $(grep mob /etc/vmware/hostd/proxy.xml | awk '{print$1}' | sed 's/ //g') );  commentedmob=(); commentedmob=( $(awk '/!--/, $NF ~ /--&gt;/ ' /etc/vmware/hostd/proxy.xml | grep mob) );  activemob=(); for m in "${mobentries[@]}"; do skip= ; for c in "${commentedmob[@]}"; do if [[ $m = $c ]]; then { skip=1; break; }; fi; done; [[ -n $skip ]] ||  activemob+=($m); done; for a in ${activemob[@]}; do  echo "Fail: the following mob entries in the proxy config file are active ---   $a   --- .";  done </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
    </xccdf:Group>    
    <xccdf:Group id="Virtual-Machine--Settings">
        <xccdf:title>Virtual Machine - Settings</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Disable-Guest-Control-of-Hardware-Devices" role="full" selected="false" weight="1.0">
            <xccdf:title>Remove Guest Control of Hardware Devices</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Do not allow guests to control hardware devices outside of ESX or vCenter.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Guest control of hardware devices could lead to resource conflicts and possible
                        poor performance, or access to unauthorized devices and data stored on those devices.    
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Perform the following actions using the vCenter management console to set guest control: 
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the &lt;guest name&gt; in the navigation tree.</xhtml:li>
                        <xhtml:li>Select Edit Settings.</xhtml:li>
                        <xhtml:li>Select the Options tab.</xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line item).  </xhtml:li>
                        <xhtml:li>Click on the Configuration Parameters button. 
                            <xhtml:p>
                                <xhtml:strong>Note:</xhtml:strong> The configuration parameters panel will pop up with each setting listed with a Name 
                                and Value pair per line. 
                            </xhtml:p>
                        </xhtml:li>
                        <xhtml:li>
                            Add the name value pair below:
                            <xhtml:p>
                                <xhtml:code>isolation.device.connectable.disable    true</xhtml:code>
                            </xhtml:p>
                        </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>   
                    <ecl:shell-command check="none exist" comment="Any guests listed below have not disabled the device connection capability." success="pass">
                        <ecl:command>find /vmfs/volumes/ -name *.vmx | xargs grep -L 'isolation.device.connectable.disable = "true"'</ecl:command>     
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Appropriately-Size-the-Information-a-Guest-Can-Store-in-a-Configuration-File" role="full" selected="false" weight="1.0">
            <xccdf:title>Appropriately Size the Information a Guest Can Store in a Configuration File</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        ESX 4 has added the ability to limit the amount of data that can be stored in a guest’s 
                        vmx configuration files.  The default limit is 1 mb of storage. If your guest has extensive 
                        custom configurations and is sending many setinfo type messages to the configuration file, 
                        the file could become full. Appropriately provide sufficient space for the vmx configuration
                        file.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If configuration settings or setinfo messages cannot be written to the vm configuration file,
                        the next startup of the guest may be missing components needed for its operation.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        After determining the appropriate size for the vmx configuration file, if more than 1 mg, perform 
                        the following actions using the vCenter management console to size the vmx file 
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>If running, shut down the virtual machine from within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the guest name in the navigation tree.</xhtml:li>
                        <xhtml:li>Select Edit Settings.</xhtml:li>
                        <xhtml:li>Select the Options tab. </xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line item). </xhtml:li>
                        <xhtml:li>Click on the Configuration Parameters button.
                            <xhtml:p>
                                <xhtml:strong>Note:</xhtml:strong> The configuration parameters panel will pop up with each setting listed with a Name 
                                and Value pair per line. 
                            </xhtml:p>
                        </xhtml:li>
                        <xhtml:li>
                            While on the configuration parameters pop-up panel, click on the Add button and add Name 
                            and Value pairs: 
                            <xhtml:p>
                                <xhtml:strong>tools.setinfo.sizeLimit = nnnnnnn     (in bytes)</xhtml:strong>
                            </xhtml:p>
                        </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
            <xccdf:check system="http://cisecurity.org/check">
                <xccdf:check-content>
                    <ecl:shell-command check="none exist" comment="Any guests listed below have not limited the size of setinfo messages. Any guests not listed have a setinfo message storage size setting, but you should separately evaluate the size of the setting for agreement with your organization's policy." success="pass">
                        <ecl:command>find /vmfs/volumes/ -name *.vmx | xargs grep -L 'tools.setinfo.sizeLimit ='</ecl:command>     
                    </ecl:shell-command>
                </xccdf:check-content>
            </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Disable-Guest-Copy-and-Paste" role="full" selected="false" weight="1.0">
            <xccdf:title>Disable Guest Copy and Paste</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Disable the ability of data to be cut and paste from the guest to the host 
                        that is enabled when vmware-tools are installed in a guest.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The cut and paste capability provides the ability to place executable files on a destination
                        without logging to trace actions to users.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Perform the following actions using the vCenter management console to set guest control: 
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the &lt;guest virtual machine&gt; name in the navigation tree. </xhtml:li>
                        <xhtml:li>Select Edit Settings. </xhtml:li>
                        <xhtml:li>Select the Options tab. </xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line item).  </xhtml:li>
                        <xhtml:li>Click on the Configuration Parameters button.
                            <xhtml:p>
                                <xhtml:strong>Note:</xhtml:strong> The configuration parameters panel will pop up with each setting listed with a Name 
                                and Value pair per line. 
                            </xhtml:p>
                        </xhtml:li>
                        <xhtml:li>
                            While on the configuration parameters pop-up panel, compare each of the three setting 
                            shown below to the Value field: 
                            <xhtml:p>
                                <xhtml:code>
                                    isolation.tools.copy.disable      true <xhtml:br/>
                                    isolation.tools.paste.disable     true <xhtml:br/>
                                    isolation.tools.setGUIOptions.enable  false 
                                </xhtml:code>
                            </xhtml:p>
                        </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below have not disabled 'copy'.  (The command first lists all VMs, then determines which VMs have tools installed, then checks those VMs for copy.disable not equal to true) ." success="pass">
                            <ecl:command> vmx_list=( $(find /vmfs/volumes/ -name *.vmx) );  vmwithtools=( $(for v in ${vmx_list[@]}; do grep -l isolation.tools $v; if [ $? == 0 ]; then vmwithtools+=($v); fi; done) ); for w in ${vmwithtools[@]}; do grep -L 'isolation.tools.copy.disable = "true"' $w; done </ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below have not disabled 'paste'.  (The command first lists all VMs, then determines which VMs have tools installed, then checks those VMs for paste.disable not equal to true)" success="pass">
                            <ecl:command>  vmx_list=( $(find /vmfs/volumes/ -name *.vmx) );  vmwithtools=( $(for v in ${vmx_list[@]}; do grep -l isolation.tools $v; if [ $? == 0 ]; then vmwithtools+=($v); fi; done) ); for w in ${vmwithtools[@]}; do grep -L 'isolation.tools.paste.disable = "true"' $w; done </ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below have not disabled 'GUIoptions'.  (The command first lists all VMs, then determines which VMs have tools installed, then checks those VMs for GUI.options.enable not equal to false)" success="pass">
                            <ecl:command>vmx_list=( $(find /vmfs/volumes/ -name *.vmx) );  vmwithtools=( $(for v in ${vmx_list[@]}; do grep -l isolation.tools $v; if [ $? == 0 ]; then vmwithtools+=($v); fi; done) ); for w in ${vmwithtools[@]}; do grep -L 'isolation.tools.setGUIOptions.enable = "false"' $w; done </ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>
        <xccdf:Rule id="Rotate-VM-Log-Files-on-the-Host-and-Limit-Their-Size" role="full" selected="false" weight="1.0">
            <xccdf:title>Rotate VM Log Files on the Host and Limit Their Size</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Set the maximum size of each log file and number of log files to retain in each guest
                        directory under /vmfs/volumes/-yourstoragedevice-/ to:
                        <xhtml:ul>
                            <xhtml:li>Rotate the current log file when the size is greater than or equal to 10000000 Bytes.</xhtml:li>
                            <xhtml:li>Retain less than or equal to 30 historical log files.</xhtml:li>
                        </xhtml:ul>
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Limiting the size of the log files will help minimize possible denial of service attacks
                        on log file data-store should they become full.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Perform the following actions using the vCenter management console to set guest control: 
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the &lt;guest virtual machine&gt; name in the navigation tree </xhtml:li>
                        <xhtml:li>Select Edit Settings.</xhtml:li>
                        <xhtml:li>Select the Options tab.</xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line item).  </xhtml:li>
                        <xhtml:li>
                            Click on the Configuration Parameters button. 
                            <xhtml:p>
                                <xhtml:strong>Note:</xhtml:strong> The configuration parameters panel will pop up with each setting listed with a Name 
                                and Value pair per line. 
                            </xhtml:p>
                        </xhtml:li>
                        <xhtml:li>
                            While on the configuration parameters pop-up panel, double click on any of the two 
                            settings are not present, click on the Add button to create a new Name and Value pair as
                            shown below: 
                            <xhtml:p>
                                <xhtml:code>
                                    log.rotateSize      10000000 <xhtml:br/>
                                    log.keepOld       30 
                                </xhtml:code>
                            </xhtml:p>
                        </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="AND">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below have no setting for log file size and fail this requirement." success="pass">
                            <ecl:command>find /vmfs/volumes/ -name *.vmx | xargs grep -L 'log.rotateSize'</ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below have a log size specified, but the size value is greater than 10000000." success="pass">
                            <ecl:command>find /vmfs/volumes/ -name *.vmx | xargs grep 'log.rotateSize' | awk -F"\"" '$2 &gt; 10000000'</ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below have no setting for log file rotation and fail this requirement." success="pass">
                            <ecl:command>find /vmfs/volumes/ -name *.vmx | xargs grep -L 'log.keepOld'</ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below have a log rotation specified, but the rotation value is greater than 30." success="pass">
                            <ecl:command>find /vmfs/volumes/ -name *.vmx | xargs grep 'log.keepOld' | awk -F"\"" '$2 &gt; 30'</ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>
        <xccdf:Rule id="Retain-Virtual-Machine-Communications-Interface-VMCI-in-a-Disabled-State" role="full" selected="false" weight="1.0">
            <xccdf:title>Retain Virtual Machine Communications Interface (VMCI) in a Disabled State</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The Virtual Machine Communications Interface (VMCI) used in VMware virtual 
                        hardware version 7 is a virtual Peripheral Component Interconnect (PCI) equivalent socket layer
                        device that allows virtual machines to communicate directly to each other and the ESX host,
                        without the need to traverse the network layer.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Direct communication bypasses traditional network firewalls and monitoring techniques.
                        The default setting of disabled should be retained unless a specific there is an authorized
                        exception.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        No action is needed if the default setting has not been altered. If the default setting has been 
                        altered: 
                    </xhtml:p>
                    <xhtml:p>
                        Login to the vCenter management console: 
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Select a &lt;guest virtual machine&gt; to edit in the Inventory tree. </xhtml:li>
                        <xhtml:li>Right click on the &lt;guest virtual machine&gt; name in the navigation tree, select Edit Settings. </xhtml:li>
                        <xhtml:li>Read the VCMI device line (if not visible, check the "Show All Devices" box in the upper 
                        left) the default should read "Restricted" on the right side of the VCMI line.</xhtml:li>
                        <xhtml:li>If the right side of the VCMI lines read "Unrestricted"</xhtml:li>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Uncheck the "Enable VCMI Between VMs" box to the right</xhtml:li>
                        <xhtml:li>Restart the virtual machine</xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="Any guests listed below have VMCI enabled, compare the guests below against your organizations's authorized list of guests that are allowed this feature.  Also, check the VMCI id's for uniqueness.">
                            <ecl:command> find /vmfs/volumes/ -name *.vmx | xargs grep -EH '(vmci0.id =|vmci0.present = "true")' </ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Prevent-Virtual-Disk-Shrinkage" role="full" selected="false" weight="1.0">
            <xccdf:title>Prevent Virtual Disk Shrinkage</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The installation of VMware Tools within a VM, commonly done to obtain higher 
                        performance drivers, also enables disk shrinkage functionality.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If a user inside a VM can access the tools interface, possibly without administrative or root
                        privileges, they may be able to perform a disk shrinkage function that could take the VM 
                        off-line and create a denial of service situation. 
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Disable the disk shrinkage functionality of VMware Tools (while leaving the other benefits in 
                        place, by editing the VM configuration. 
                    </xhtml:p>
                    <xhtml:p>Login to the vCenter management console: </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Select a &lt;guest virtual machine&gt; to assess in the Inventory tree.</xhtml:li>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the &lt;guest virtual machine&gt; name in the navigation tree, select Edit Settings. </xhtml:li>
                        <xhtml:li>Select the Options tab.</xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line item).  </xhtml:li>
                        <xhtml:li>Click on the Configuration Parameters button.
                            <xhtml:p>
                                <xhtml:strong>Note:</xhtml:strong> The configuration parameters panel will pop up with each setting listed with a Name 
                                and Value pair per line. 
                            </xhtml:p>
                        </xhtml:li>
                        <xhtml:li>Scroll to the end of the list and to add the two new pairs below, click on the "Add Row" button.
                            <xhtml:p>
                                <xhtml:code>
                                    isolation.tools.diskWiper.disable      TRUE<xhtml:br/>  
                                    isolation.tools.diskShrink.disable     TRUE 
                                </xhtml:code>
                            </xhtml:p>
                        </xhtml:li>
                        <xhtml:li>Click "OK" to approve each pair</xhtml:li>
                        <xhtml:li>Click "OK" again to update the VM configuration file</xhtml:li>
                        <xhtml:li>Restart the VM</xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below do not have disk shrinkage nor disk wipe capabilities disabled." success="pass">
                            <ecl:command> vmx_list=( $(find /vmfs/volumes/ -name *.vmx) );  vmwithtools=( $(for v in ${vmx_list[@]}; do grep -l isolation.tools $v; if [ $? == 0 ]; then vmwithtools+=($v); fi; done) ); for w in ${vmwithtools[@]}; do grep -EL '(isolation.tools.diskWiper.disable = "true"|isolation.tools.diskShrink.disable = "true")' $w; done </ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Set-RemoteDisplay.maxConnections-to-One-Level" role="full" selected="false" weight="1.0">
            <xccdf:title>Set RemoteDisplay.maxConnections to One Level</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The RemoteDisplay.maxConnections setting defines the number of remote consoles
                        allowed to simultaneously access a particular virtual machine.                        
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        There is no default setting for remote display connections which allows multiple consoles to be
                        open simultaneously. With multiple consoles open, a second user, who may be of a lower access rights
                        group, could observe the actions of an administrator.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>Login to the vCenter management console: </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Select a &lt;guest virtual machine&gt; to assess in the Inventory tree.</xhtml:li>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the &lt;guest virtual machine&gt; name in the navigation tree, select Edit Settings. </xhtml:li>
                        <xhtml:li>Select the Options tab.</xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line item).  </xhtml:li>
                        <xhtml:li>Click on the Configuration Parameters button.
                            <xhtml:p>
                                <xhtml:strong>Note:</xhtml:strong> The configuration parameters panel will pop up with each setting listed with a Name 
                                and Value pair per line. 
                            </xhtml:p>
                        </xhtml:li>
                        <xhtml:li>Scroll to the end of the list and to add the two new pairs below, click on the "Add Row" button.
                            <xhtml:p>
                                <xhtml:code>
                                    RemoteDisplay.maxConnections  1 
                                </xhtml:code>
                            </xhtml:p>
                        </xhtml:li>
                        <xhtml:li>Click "OK" to approve each pair</xhtml:li>
                        <xhtml:li>Click "OK" again to update the VM configuration file</xhtml:li>
                        <xhtml:li>Restart the VM</xhtml:li>
                    </xhtml:ol>
                </xhtml:div>                
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below have no or an excessive setting for the number of console connections allowed." success="pass">
                            <ecl:command> find /vmfs/volumes/ -name *.vmx | xargs grep -L 'RemoteDisplay.maxConnections = "1"'</ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Disconnect-Unneeded-Devices" role="full" selected="false" weight="1.0">
            <xccdf:title>Disconnect Unneeded Devices</xccdf:title>
            <xccdf:description>
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        vSphere has the ability to present a variety of virtual hardware devices to the VM,
                        some of which may not be needed by the VM, either permanently or after initial installation.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Devices not needed are an unnecessary point of entry to the VM and should be removed to reduce access
                        to the VM. Devices that may be removed, depending on the intended use of  the VM include serial ports,
                        parallel ports, CD’s, USBs and floppy drives.        
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        To add or delete devices available to the VM: first shutdown the guest operating system:
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Log into vCenter and in the Inventory panel, Hosts and Clusters view, right click on a VM name </xhtml:li>
                        <xhtml:li>Select "Edit settings"</xhtml:li>
                        <xhtml:li>Within the "Virtual Machine Properties" panel, in the "Hardware" tab
                            review the list of devices for appropriateness.</xhtml:li>
                        <xhtml:li>If a device that needs to be removed, highlight that device, click on "Remove"</xhtml:li>
                        <xhtml:li>Repeat the steps in item 4 for any other devices needing removal </xhtml:li>
                        <xhtml:li>Then click on "OK" in the Properties panel to complete the removal of the device(s)</xhtml:li>
                    </xhtml:ol>
                </xhtml:div>                
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list any guests with floppy drives. Compare the output to your organizations list of guests authorized to have this device. The command below could be modified to search for other devices.">
                            <ecl:command>find /vmfs/volumes/ -name *.vmx | xargs grep -i 'floppy0.present = "TRUE"'</ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Remotely-Log-VMs-with-Non--Persistent-Disks" role="full" selected="false" weight="1.0">
            <xccdf:title>Remotely Log VM's with Non-Persistent Disks</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        VM disks have a configuration option of Independent Mode which is not affected by
                        snapshots. In this mode changes to the VM are discarded when the VM is rebooted or powered off 
                        if the Nonpersistent option is selected.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        While potentially useful in a development environment, when using VMs in production it is
                        recommended not to use the Independent Nonpersistent Mode.  If the Independent Nonpersistent Mode
                        is required, it is recommended that the VM remotely log relevant system events to a external log server,
                        if not, a record of the activity on the VM between reboots or shutdowns will be lost.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        To change disk options,  first shutdown the guest operating system: 
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Log into vCenter and in the Inventory panel, Hosts and Clusters view, right click on a VM name </xhtml:li>
                        <xhtml:li>Select "Edit settings"</xhtml:li>
                        <xhtml:li>Within the "Virtual Machine properties" panel, in the "Hardware" tab 
                          review the list of disks for appropriateness</xhtml:li>
                        <xhtml:li>Highlight the disk, and review the settings in the Mode section on the right </xhtml:li>
                        <xhtml:li>If "Independent" mode is appropriate click on the "Persistent" radio button</xhtml:li>
                        <xhtml:li>If "Independent" mode is not appropriate, uncheck the box next to "Independent"</xhtml:li>
                        <xhtml:li>Repeat the steps in items 4-6 for any additional disks</xhtml:li>
                        <xhtml:li>Then click on "OK" in the Properties panel to complete disk configuration</xhtml:li>
                        <xhtml:li>If requirements dictate an Independent Nonpersistent disk, then, within the guest, 
                            configure copying of the appropriate logs to a remote server with the designated tools </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list guests using independent-nonpersistent disks. The VM's in this list should be reviewed  to determine if sufficient logging exists, within the VM, to recreate the events that transpired inside the VM between startup and shutdown.">
                            <ecl:command> find /vmfs/volumes/ -name *.vmx | xargs grep -i 'scsi.:.\.mode = "independent-nonpersistent"' </ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Disable-the-VIX-API" role="full" selected="false" weight="1.0">
            <xccdf:title>Disable the VIX API</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The VMware VIX application programming interface allows for control of VM operations
                        (i.e. power-on, power-off, copy files, run programs, and other functions) on the guest containing 
                        the VIX tools or another guest.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The functions above should be limited to skilled and trained virtualization administrators and this
                        capability generally does not need to be provided within a VM as sufficient tools (i.e. VI Client
                        to vCenter, vMA, PowerCLI) are available on an administrators workstation outside of a VM for
                        management of VMs.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Disable the ability of a VM to issue commands that may affect itself adversely or other VMs by 
                        performing the following: 
                    </xhtml:p>
                    <xhtml:p>
                        Login to the vCenter management console:
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Select a &lt;guest virtual machine&gt; to edit in the Inventory tree.</xhtml:li>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the powered-off &lt;guest virtual machine&gt; name in the navigation tree, select 
                            Edit Settings. </xhtml:li>
                        <xhtml:li>Select the Options tab.</xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line 
                            item).  </xhtml:li>
                        <xhtml:li>Click on the Configuration Parameters button.</xhtml:li>
                        <xhtml:li>Click on "Add Row", this will take you to the bottom of the list</xhtml:li>
                        <xhtml:li>Enter "guest.command.enabled" on the left side of the entry</xhtml:li>
                        <xhtml:li>Enter "False" on the right side of the entry</xhtml:li>
                        <xhtml:li>Click "OK", and "OK" once more to save the entry</xhtml:li>
                        <xhtml:li> Restart the VM </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below may have functionality allowed by the VIX toolset, possibly allowing powering off of other guests." success="pass">
                            <ecl:command> let goodcounter=0; vmx_list=( $(find /vmfs/volumes/ -name *.vmx) );  for w in ${vmx_list[@]}; do grep -li 'guest.command.enabled= "TRUE"' $w; if [ $? == 1 ]; then let goodcounter=goodcounter+1; fi; done; if [ $goodcounter -eq ${#vmx_list[@]} ]; then let flag=1; fi </ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
        <xccdf:Rule id="Disable-ESX-Host-Performance-Data-Delivery-to-a-VM" role="full" selected="false" weight="1.0">
            <xccdf:title>Disable ESX Host Performance Data Delivery to a VM</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Host performance data may be sent to VMs, by default this setting is disabled.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If a VM obtains performance data from the host without an approved purpose, that data may be 
                        available to a  broader audience than authorized. The host information could be used for 
                        footprinting and planning possible future attacks against the host.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Login to the vCenter management console:
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Select a &lt;guest virtual machine&gt; to edit in the Inventory tree.</xhtml:li>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the powered-off &lt;guest virtual machine&gt; name in the navigation tree, select 
                            Edit Settings. </xhtml:li>
                        <xhtml:li>Select the Options tab.</xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line 
                            item).  </xhtml:li>
                        <xhtml:li>Click on the Configuration Parameters button.</xhtml:li>
                        <xhtml:li>Click on "Add Row", this will take you to the bottom of the list</xhtml:li>
                        <xhtml:li>Enter "tools.guestlib.enableHostInfo" on the left side of the entry</xhtml:li>
                        <xhtml:li>Enter "False" on the right side of the entry</xhtml:li>
                        <xhtml:li>Click "OK", and "OK" once more to save the entry</xhtml:li>
                        <xhtml:li> Restart the VM </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="Any guests listed below may have the ability to record some host information. Any guests on the list below should have an authorized exception." success="pass">
                            <ecl:command> vmx_list=( $(find /vmfs/volumes/ -name *.vmx) );  for w in ${vmx_list[@]}; do grep -Li 'tools.guestlib.enableHostInfo = "FALSE"' $w; done </ecl:command>     
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>
    </xccdf:Group>
    <xccdf:Group id="Virtual-Machine--Other">
        <xccdf:title>Virtual Machine - Other</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Disable-VMsafe-Except-for-Approved-Appliances" role="full" selected="false" weight="1.0">
            <xccdf:title>Disable VMsafe Except for Approved Appliances</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        VMsafe allows one VM acting as a security device to inspect CPU/Memory or
                        Networking resource usage of other VMs.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        These security devices gather a large volume of information about a VM; much of which is
                        sensitive and should be limited to approved devices. If an unauthorized VMsafe VM were
                        deployed it could gather information about other VM's that could lead to data theft or 
                        privilege escalation. 
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        VMs acting as a security appliance/application must be expressly defined to VMsafe. For each VM 
                        approved to inspect resources on other guests to enable VMsafe: 
                    </xhtml:p>
                    <xhtml:p>
                        Login to the vCenter management console:
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Select a &lt;guest virtual machine&gt; to edit in the Inventory tree.</xhtml:li>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the powered-off &lt;guest virtual machine&gt; name in the navigation tree, select 
                            Edit Settings. </xhtml:li>
                        <xhtml:li>Select the Options tab.</xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line 
                            item).  </xhtml:li>
                        <xhtml:li>Click on the Configuration Parameters button.</xhtml:li>
                        <xhtml:li>Click on "Add Row", this will take you to the bottom of the list</xhtml:li>
                        <xhtml:li>To enable CPU/Memory introspection:
                            <xhtml:ul>
                                <xhtml:li>Enter "ethernetX.networkName" on the left side of the entry where X is the NIC number</xhtml:li>
                                <xhtml:li>Enter "VMsafe-appliances" on the right side of the entry</xhtml:li>
                                <xhtml:li>Click "OK" to approve this entry</xhtml:li>
                            </xhtml:ul>
                        </xhtml:li>
                        <xhtml:li>To enable Network introspection: 
                            <xhtml:ul>
                                <xhtml:li>Enter "ethernetX.networkName" on the left side of the entry where X is the NIC number</xhtml:li>
                                <xhtml:li>Enter "dvfilter-appliances" on the right side of the entry</xhtml:li>
                                <xhtml:li>Click "OK" to approve this entry</xhtml:li>
                            </xhtml:ul></xhtml:li>
                        <xhtml:li>Click "OK", and "OK" once more to save the entry</xhtml:li>
                        <xhtml:li> Restart the VM </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command will list any guests that are acting in a security role with access to other guest resources (memory/cpu, networking).  Ensure each guest on the list is authorized for that interception role." success="pass">
                            <ecl:command>  let goodcounter=0; vmx_list=( $(find /vmfs/volumes/ -name *.vmx) ); for w in ${vmx_list[@]}; do grep -Eli '(\.networkName = "VMsafe-appliances"|\.networkName = "dvfilter-appliances")' $w; if [ $? == 1 ]; then let goodcounter=goodcounter+1; fi;  done; if [ $goodcounter -eq ${#vmx_list[@]} ]; then let flag=1; fi </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>   
        <xccdf:Rule id="Disable-VM-Participation-in-VMsafe-Introspection-Unless-Approved" role="full" selected="false" weight="1.0">
            <xccdf:title>Disable VM Participation in VMsafe Introspection Unless Approved</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        VMsafe allows one VM acting as a security device to inspect CPU/Memory or
                        Networking resource usage of other VMs.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Any VM that does not meet the requirements for the type of resource usage that is monitored
                        by a VMsafe appliance, should not be monitored by that VMsafe appliance or inappropriate
                        data leakage may occur.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        VMs being monitored by a security appliance/application must be expressly configured to pass 
                        information to the VMsafe device. For each VM approved to be inspected, activate VMsafe on this 
                        monitored VM by:  
                    </xhtml:p>
                    <xhtml:p>
                        Login to the vCenter management console:
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Select a &lt;guest virtual machine&gt; to edit in the Inventory tree.</xhtml:li>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the powered-off &lt;guest virtual machine&gt; name in the navigation tree, select 
                            Edit Settings. </xhtml:li>
                        <xhtml:li>Select the Options tab.</xhtml:li>
                        <xhtml:li>Select the General line item indented from the Advanced line (not the General Options line 
                            item).  </xhtml:li>
                        <xhtml:li>Click on the Configuration Parameters button.</xhtml:li>
                        <xhtml:li>Click on "Add Row", this will take you to the bottom of the list</xhtml:li>
                        <xhtml:li>To enable CPU/Memory introspection:
                            <xhtml:ul>
                                <xhtml:li>Enter "VMsafe.enable" on the left side of the entry</xhtml:li>
                                <xhtml:li>Enter "TRUE" on the right side of the entry</xhtml:li>
                                <xhtml:li>Enter "VMsafe.agentAddress" on the left side of the entry</xhtml:li>
                                <xhtml:li>Enter "xxx.xxx.xxx.xxx" on the right side of the entry 
                                representing the IP address of the approved VMsafe monitoring applicance</xhtml:li>
                                <xhtml:li>Enter "VMsafe.agentPort" on the left side of the entry</xhtml:li>
                                <xhtml:li>Enter "xxxxx" on the right side of the entry representing the 
                                  port number of the approved VMSafe monitoring appliance</xhtml:li>
                                <xhtml:li>Click "OK" to approve these three entries</xhtml:li>
                            </xhtml:ul>
                        </xhtml:li>
                        <xhtml:li>To enable Network introspection: 
                            <xhtml:ul>
                                <xhtml:li>Enter "ethernetX.filterY.name" on the left side of the entry where X is the NIC number 
                                Y is the VMsafe path number</xhtml:li>
                                <xhtml:li>Enter "dv-filterY" on the right side of the entry where Y is the VMsafe path number</xhtml:li>
                                <xhtml:li>Click "OK" to approve this entry</xhtml:li>
                            </xhtml:ul></xhtml:li>
                        <xhtml:li>Click "OK", and "OK" once more to save the 4 entries</xhtml:li>
                        <xhtml:li> Restart the VM </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="The VMs below are providing introspection data to a VMwafe appliance, ensure these guests should be divulging this information." success="pass">
                            <ecl:command> let goodcounter=0; vmx_list=( $(find /vmfs/volumes/ -name *.vmx) ); for w in ${vmx_list[@]}; do grep -Eli '(VMsafe.enable = "TRUE"|VMsafe.agentAddress|VMsafe.agentPort|dv-filter)' $w; if [ $? == 1 ]; then let goodcounter=goodcounter+1; fi;  done; if [ $goodcounter -eq ${#vmx_list[@]} ]; then let flag=1; fi </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>  
        <xccdf:Rule id="Disable-VM-DirectPath-IO-Devices-Unless-Approved" role="full" selected="false" weight="1.0">
            <xccdf:title>Disable VM DirectPath IO Devices Unless Approved</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        VMDirectPath allows a VM to communicate with a qualifying host device, usually
                        storage or network related, without hypervisor involvement. Generally this results in enhanced
                        throughput performance.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Utilizing VMDirectPath, thus bypassing the hypervisor, may reduce the ability of the host to 
                        balance loads and resolve contention. Furthermore, certain hypervisor functionality such as
                        VMotion and Distributed Resource Scheduling (DRS) is disabled if VMDirectPath is enabled for a VM,
                        reducing continuity options for any VMs using VMDirectPath.        
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        To configure a VM to utilize VMDirectPath login to the vCenter management console: 
                    </xhtml:p>
                    <xhtml:ol>
                        <xhtml:li>Select a "guest virtual machine" to edit in the Inventory tree. </xhtml:li>
                        <xhtml:li>If running, shut down the virtual machine within the guest using the appropriate procedure. </xhtml:li>
                        <xhtml:li>Right click on the powered-off "guest virtual machine" name in the navigation tree, select Edit Settings. </xhtml:li>
                        <xhtml:li>Select the Hardware tab. </xhtml:li>
                        <xhtml:li>Select the desired device, click "Next" and select other settings 
                          appropriate for this device, click "OK"</xhtml:li>
                        <xhtml:li>Restart the VM </xhtml:li>
                    </xhtml:ol>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command check="none exist" comment="This command lists any VM that has enabled PCI Passthrough. Verify that any guest on the list has an authorized exception. (the first command lists all VMs, the second command identifies VMs with a passthru setting, and the thrid command lsists those VMs 'present' setting equal to 'true') " success="pass">
                            <ecl:command> vmx_list=( $(find /vmfs/volumes/ -name *.vmx) );  vmwithpassthru=( $(for v in ${vmx_list[@]}; do grep -l 'pciPassthru.\.present = "' $v; if [ $? == 0 ]; then vmwithpassthru+=($v); fi; done) ); for w in ${vmwithpassthru[@]}; do grep -li 'pciPassthru.\.present = "true"' $w; done </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>  
        <xccdf:Rule id="Ensure-Linked-Clones-are-of-Equal-Security-Classification" role="full" selected="false" weight="1.0">
            <xccdf:title>Ensure Linked Clones are of Equal Security Classification</xccdf:title>
            <xccdf:description>  
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Using the VMware vSphere Web Services Software Development Kit (SDK) or 
                        additional products like Lab Manager, shared or base virtual disks (.VMDK) can be created that
                        contain a common set of operating system and application bytes that are shared between multiple
                        VMs. The VMs then create differential or delta disks containing the content that is unique to them.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        A VM using a linked cloned disk will not have unique access to that portion of VM residing on
                        the linked cloned base disk. The resulting information sharing should only take place between
                        machine authorized to do so and of the same security class. Further, VMs using a linked cloned
                        base disk cannot use VMware’s High Availability (HA) mirroring, reducing continuity options for
                        affected VMs.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Use Lab Manager or a similar product, or write custom API  scripts to create linked clone disks 
                        (vmdk).   
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command will list the VMs with delta disks indicating they are using a linked base disk. Use LabManager  to determine the base disk these are using and determine if the collaborative use agrees with your oprganizations policy.Also check that CHAP Authentication 'true' is turned on, if the iSCSI services is enabled through the firewall.">
                            <ecl:command> find /vmfs/volumes/ -name *delta.vmdk </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>  
        <xccdf:Rule id="Use-Active-Directory-Authentication-with-vMA-4--1" role="full" selected="false" weight="1.0">
            <xccdf:title>Use Active Directory Authentication with vMA 4-1</xccdf:title>
            <xccdf:description>   
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The vSphere Management Assistant (vMA) appliance 4.1 added the capability to authenticate
                        against an active directory server.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        In vMA version 4.0 and prior, and in version 4.1 if adauth is not used,  authentication information is stored
                        locally on the vMA appliance.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        To specify a host or vCenter server that is accessed by a vMA appliance specify the adauth meth
                        when establishing the connection to the host or vCenter server. In the vMA appliance enter: 
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:code>vifp &lt;youtservername&gt; --authpolicy adauth --username &lt;yourdomain&gt;\\&lt;youruser&gt; </xhtml:code>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This test  'vifp listservers –l'  must be performed within the vMA 4.x appliance, not on the host.">
                            <ecl:command>  </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>  
        <xccdf:Rule id="Monitor-Thin-Provisioned-Use-to-Avoid-Storage-Over--committment" role="full" selected="false" weight="1.0">
            <xccdf:title>Monitor Thin Provisioned Use to Avoid Storage Over-committment</xccdf:title>
            <xccdf:description>  
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Thin disk provisioning consumes storage space when the VM requires that resource.
                        The space is not committed entirely at VM creation. The total of all provisioned disk space can
                        exceed the physical size of the storage device because only the amount actually used by the VM
                        is decremented from the datastore “Free” measurement as shown in vCenter, not the provisioned 
                        (higher) amount.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If the total thinly provisioned , but unused, disk space total exceeds the “Free” disk space
                        physically available on a storage device, and enough VM events require additional provisioned
                        space exceeding remaining physical space, VMs could suffer shutdowns. 
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Monitor uncommitted space potential additional space requests of thinly provisioned VMs. In  
                        vCenter server, select each VM and on the "Summary" tab, note 
                        the data storage device(s) used by the guest. For each guest, click on the "Refresh Storage Usage" 
                        to obtain a current measure of disk consumption. Subtract the "Used Storage" amount from the 
                        "Provisioned Storage" amount to obtain the uncommitted storage amount. Add the uncommitted storage 
                        amount for each VM per storage device and compare the total per storage device to the "Free" physical
                        storage space shown in the "Datastore" section. Any per-VM total that exceeds the device 
                        "Free" value should be reviewed for possible storage capacity additions or VM movement 
                        to other devices. Additionally, alarms could be defined to warn of disk overcommitment above certain
                        levels (i.e. 150%) and provisioned space consumption (i.e. 75%)
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="The following command will report (the last numeric value) the remaining disk space on a volume. Use Virtual Center to determine the maximum additional space each VM could request, total those amounts and if greater than the amount returned by this command, maximizing all VM's storage allocation could lead to a denial of service.">
                            <ecl:command>  vdf -h | grep '\/vmfs\/volumes\/' | awk '{print $1 "  " $3}'  </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>  
    </xccdf:Group>
    <xccdf:Group id="Other">
        <xccdf:title>Other</xccdf:title>
        <xccdf:description/>
        <xccdf:Rule id="Password-Protect-the-Boot-Loader-GRUB" role="full" selected="false" weight="1.0">
            <xccdf:title>Password Protect the Boot Loader (GRUB)</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Protect the configuration of the boot loader GRUB, which controls the operating 
                        systems used at host startup and parameters used by those operating systems to initialize the host.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        This loader and its parameters need password protection (see sections 1.4.5 through 1.4.8 for 
                        password configuration guidance) to avoid booting from unauthorized operating systems, or the 
                        passing of unauthorized parameters to an authorized operating system at startup. The controls 
                        suggested in this section also help mitigate the risk of booting the system into the privileged 
                        single user mode described in section 1.4.10. The default installation of ESX 4 provides no GRUB 
                        password.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        To create a GRUB password use the command below to generate a 32 character hash of your 
                        chosen password:
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:code>/sbin/grub-md5-crypt &lt;yourpassword&gt; </xhtml:code>
                    </xhtml:p>
                    <xhtml:p>
                        Open the /boot/grub/grub.conf file with an editor and add the 32 character hash by adding the 
                        line password md5 &lt;thehashgeneratedabove&gt;  after the timeout line: 
                    </xhtml:p>
                    <xhtml:p>
                        <xhtml:code>password md5 &lt;thehashgeneratedabove&gt;: </xhtml:code>
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="The command below will identify if the key word password is present in the grub.conf file. Even if that line is present, the grub.conf file needs to be reviewed for password conformance with your organization's policy." success="pass">
                            <ecl:command> grep password /boot/grub/grub.conf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>   
        <xccdf:Rule id="Replace-Vendor-SSL-Certificates" role="full" selected="false" weight="1.0">
            <xccdf:title>Replace Vendor SSL Certificates</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Replace the certificates used during SSL network encryption from the vendor
                        defaults to a trusted certificate authority, internal or external.
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        If default self-signed certificates are used, while unique to each server, they create additional
                        exposure to man-in-the-middle attacks without independent verification that the signed certificate’s
                        value is valid.
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        Replacing the default certificates and using your choice of trusted certificate authority, internal 
                        and external.  Use the vendors guide shown in the reference below and your organizations 
                        procedures for certificates, internal or external, to deploy a secure certificate. 
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="The command, &quot;cat /etc/pki/tls/openssl.cnf&quot; output (more than 200 lines) should be reviewed for certiciate settings conforming to your organization's policy.">
                            <ecl:command> cat /etc/pki/tls/openssl.cnf</ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
        </xccdf:Rule>   
        <xccdf:Rule id="Configure-Security-Event-Logging--auditd" role="full" selected="false" weight="1.0">
            <xccdf:title>Configure Security Event Logging (auditd)</xccdf:title>
            <xccdf:description> 
                <xhtml:div>
                    <xhtml:p class="explanation"><xhtml:b>Description:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The security event daemon auditd, is enabled at start up on ESX 4 to log actions
                        of users into the file /var/log/audit/audit.log.  The size and location and other behaviors of
                        this daemon are controlled with parameters in the file /etc/audit/auditd.conf. Custom rules
                        specified by your organization can be created in the file /etc/audit/audit.rules using the command
                        auditctl.  
                    </xhtml:p>
                    
                    <xhtml:p class="rationale"><xhtml:b>Rationale:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        The configuration of the auditd daemon should be reviewed to ensure the log file location,
                        actions upon space limits, and other configuration settings are aligned with the organization’s
                        policy to avoid the disk being consumed by log entries.  Any custom rules should be created to
                        track high risk activities (not captured in other logs) or events generated by specific users 
                        to allow for research. 
                    </xhtml:p>
                    
                    <xhtml:p class="check"><xhtml:b>Remediation:</xhtml:b></xhtml:p>
                    <xhtml:p>
                        To review or change the auditd daemon configuration open the file /etc/audit/auditd.conf 
                        with an editor and add or change entries such that the configuration agrees with the  policy. 
                    </xhtml:p>
                    <xhtml:p>
                        To add or change custom rules, use the auditctl command to add to the list of the cistom audit 
                        rules in /etc/audit/audit.rules  
                    </xhtml:p>
                </xhtml:div>
            </xccdf:description>
            <xccdf:complex-check operator="OR">
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="This command lists the settings of the auditd configuration file, review the output for conformance with your organization's policy.">
                            <ecl:command> cat /etc/audit/auditd.conf </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
                <xccdf:check system="http://cisecurity.org/check">
                    <xccdf:check-content>
                        <ecl:shell-command comment="The command below will list any custom rules that have been constructed for use with the auditd daemon, review the output for conformance with your organization's policy.">
                            <ecl:command> auditctl -l </ecl:command>
                        </ecl:shell-command>
                    </xccdf:check-content>
                </xccdf:check>
            </xccdf:complex-check>
        </xccdf:Rule>   
    </xccdf:Group>
<xccdf:signature><ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
<ds:SignedInfo>
<ds:CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/>
<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>
<ds:Reference URI="">
<ds:Transforms>
<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
<ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
</ds:Transforms>
<ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/>
<ds:DigestValue>YlYfVT9OFMbY3JDx9n5fQIkKBCE=</ds:DigestValue>
</ds:Reference>
</ds:SignedInfo>
<ds:SignatureValue>
R5kXS8NPd9EsX5qqqfERon2ScWeHy8K535pFWDcJmJ1HpV9jyI4rOy165/GN3loNVeUxX4KaTEuZ
A4OFHvdmccrtajsrYSFWQ4oqs9z7RqvA2QXFW3CHzjZui5cyZmdRtqN/P7UXzorR1DBvFZahMH0+
qqd4McXj0KpkVZaq376yooYYan+FNSOlgffWpyxjeye9sQ69OWCO3VihWFk20wMXsv+fO0gO2nDT
HnxkXWZbh5IdO0t2uwDc+88rwtDZy11GsNXotuFJik+czCweGL6glS8Cfytct5XuE5Kw0zjFl/2z
/6vzvkIgKhrU2ZPCeiOO5obkDLxC/9nhZQl0Qw==
</ds:SignatureValue>
<ds:KeyInfo>
<ds:X509Data>
<ds:X509Certificate>
MIIFRzCCBC+gAwIBAgIHTwpN/4tOfDANBgkqhkiG9w0BAQsFADCBtDELMAkGA1UEBhMCVVMxEDAO
BgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNjb3R0c2RhbGUxGjAYBgNVBAoTEUdvRGFkZHkuY29t
LCBJbmMuMS0wKwYDVQQLEyRodHRwOi8vY2VydHMuZ29kYWRkeS5jb20vcmVwb3NpdG9yeS8xMzAx
BgNVBAMTKkdvIERhZGR5IFNlY3VyZSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgLSBHMjAeFw0xNDA5
MTgxNDM0MjFaFw0xNzEwMjAxODU3NDRaMIGTMQswCQYDVQQGEwJVUzERMA8GA1UECBMITmV3IFlv
cmsxFzAVBgNVBAcTDkVhc3QgR3JlZW5idXNoMSswKQYDVQQKEyJDZW50ZXIgZm9yIEludGVybmV0
IFNlY3VyaXR5LCBJbmMuMSswKQYDVQQDEyJDZW50ZXIgZm9yIEludGVybmV0IFNlY3VyaXR5LCBJ
bmMuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0MGnj6yX2QHklGadAfTBxssvP+2f
YegPpNGXfEmPXZXrWeME2BqIbO+hKXTuwUucRK6RvQJTjgzNgOhQx3HcclRwQB4xj/14hOoZSeQ3
haw/Xjl4WofsWizM5j/g1iWBgxi3xk/aREfKKb0ulBMtP/WYFpSRjZ/Z7m5QKii0feJPxbf+wrZ+
UvNZ8uBdO+SEmbhS/DVESsEWzXn6StbQpa2dno2aIOGZXQKcUY2d3WZ4Zk+zawFcRUYslVIrOhMb
0e3+hbJEtFwm5ekehdNimSozYyyLGZJonLlvr8PfmvQ1ceu7enWCRfZrRWAlDHFaouLdtU/OmXc+
Um7cLwz8VQIDAQABo4IBezCCAXcwDAYDVR0TAQH/BAIwADATBgNVHSUEDDAKBggrBgEFBQcDAzAO
BgNVHQ8BAf8EBAMCB4AwNQYDVR0fBC4wLDAqoCigJoYkaHR0cDovL2NybC5nb2RhZGR5LmNvbS9n
ZGlnMnM1LTAuY3JsMFMGA1UdIARMMEowSAYLYIZIAYb9bQEHFwIwOTA3BggrBgEFBQcCARYraHR0
cDovL2NlcnRpZmljYXRlcy5nb2RhZGR5LmNvbS9yZXBvc2l0b3J5LzB2BggrBgEFBQcBAQRqMGgw
JAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmdvZGFkZHkuY29tLzBABggrBgEFBQcwAoY0aHR0cDov
L2NlcnRpZmljYXRlcy5nb2RhZGR5LmNvbS9yZXBvc2l0b3J5L2dkaWcyLmNydDAfBgNVHSMEGDAW
gBRAwr0njsw0gzCiM9f7bLPwtCyAzjAdBgNVHQ4EFgQU+3zn+CEg6a2xPqlBXvn64hUyoB4wDQYJ
KoZIhvcNAQELBQADggEBAEh76h1GtJ0pj04in+RUymB7fqPh6HFILkOLlTPnveyXCoHYT2M46DET
EA/NKYkoF2KA3QiZ1b+PMViuTYG2pDs71eFVPADuBCGf9IFufCDY9mPvjQiFDlLNMknXxACD8TjC
hqz+uZT2uLPw/YxkJIsCxrTQJ//ga/fHfZDrKgQfbVzxjD/4WKDe8HktjKcn+NWGPJNMgmO+IHrK
if6TB1xTo32W9QzwoXvBdLnziAUGZZghEulq6h3RCMzKPzpx5JiLlOz6JzqXHvrua+yUbr4A29Vy
vkwWgJWjyvJd2uq9MQ9l49kkrD84m41PSwpaHO99nEHRgRykopxIt8AHsIQ=
</ds:X509Certificate>
</ds:X509Data>
<ds:KeyValue>
<ds:RSAKeyValue>
<ds:Modulus>
0MGnj6yX2QHklGadAfTBxssvP+2fYegPpNGXfEmPXZXrWeME2BqIbO+hKXTuwUucRK6RvQJTjgzN
gOhQx3HcclRwQB4xj/14hOoZSeQ3haw/Xjl4WofsWizM5j/g1iWBgxi3xk/aREfKKb0ulBMtP/WY
FpSRjZ/Z7m5QKii0feJPxbf+wrZ+UvNZ8uBdO+SEmbhS/DVESsEWzXn6StbQpa2dno2aIOGZXQKc
UY2d3WZ4Zk+zawFcRUYslVIrOhMb0e3+hbJEtFwm5ekehdNimSozYyyLGZJonLlvr8PfmvQ1ceu7
enWCRfZrRWAlDHFaouLdtU/OmXc+Um7cLwz8VQ==
</ds:Modulus>
<ds:Exponent>AQAB</ds:Exponent>
</ds:RSAKeyValue>
</ds:KeyValue>
</ds:KeyInfo>
</ds:Signature></xccdf:signature></xccdf:Benchmark>